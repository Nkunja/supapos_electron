exports.id=7812,exports.ids=[7812],exports.modules={54647:()=>{},96718:(a,b,c)=>{"use strict";c.d(b,{As:()=>B,R4:()=>y,default:()=>C,w2:()=>x});var d=c(51060),e=c(53117),f=c(43210),g=c(16189);let h="https://supa.sirnkunja.co.ke/api",i=d.A.create({baseURL:h,headers:{"Content-Type":"application/json"},timeout:5e3}),j=null,k=null,l=null,m=!0,n=!1,o=null,p=(a,b,c)=>{if("undefined"!=typeof document){let d=new Date(Date.now()+1e3*c).toUTCString();document.cookie=`${a}=${encodeURIComponent(b)}; expires=${d}; path=/; secure; samesite=strict;`}},q=a=>{"undefined"!=typeof document&&(document.cookie=`${a}=; Max-Age=-99999999; path=/;`)},r=a=>{if(!a)return!1;try{let b=(0,e.s)(a);return 1e3*b.exp>Date.now()+1e4}catch(a){return!1}},s=()=>{j=null,k=null,l=null,q("access_token"),q("refresh_token"),q("user_info")},t=a=>{switch(a.toLowerCase()){case"admin":return"/admin";case"supervisor":return"/supervisor";default:return"/sales"}},u=async()=>{if(!j||!r(j))return l;try{let a=await i.get("/users/me/",{headers:{Authorization:`Bearer ${j}`}});m=!0,n=!1,o=null,Date.now();let b=a.data;return l=b,p("user_info",JSON.stringify(b),604800),b}catch(a){return"ECONNABORTED"===a.code||"ERR_NETWORK"===a.code||a.message?.includes("timeout")||a.message?.includes("Network Error")||!a.response?(m=!1,Date.now()):a.response?.status===503&&(m=!0,n=!0,o=a.response?.data?.maintenance||a.response?.data||null,Date.now()),l}},v=async(a,b)=>{try{let c=await A();if(c.maintenanceMode||c.serverError)return c;let d=(await i.post("/auth/login/",{email:a,password:b})).data;return m=!0,n=!1,o=null,Date.now(),"Login successful"===d.message&&d.tokens&&((a,b,c)=>{j=a,k=b,p("access_token",a,7200),p("refresh_token",b,604800),c&&(l=c,p("user_info",JSON.stringify(c),604800))})(d.tokens.access,d.tokens.refresh,d.user),d}catch(a){if("ECONNABORTED"===a.code||"ERR_NETWORK"===a.code||a.message?.includes("timeout")||a.message?.includes("Network Error")||!a.response)return m=!1,Date.now(),{message:"Server currently unreachable. Please check your connection and try again.",isAuthenticated:!1,serverError:!0};if(a.response?.status===503)return m=!0,n=!0,o=a.response?.data?.maintenance||a.response?.data||null,Date.now(),{message:"Server is currently under maintenance.",isAuthenticated:!1,maintenanceMode:!0,maintenanceInfo:o};return{message:a.response?.data?.message||"Login failed",isAuthenticated:!1}}},w=async()=>{try{await i.post("/auth/logout/",{refresh_token:k},{headers:{Authorization:`Bearer ${j}`}})}catch(a){}finally{s()}},x=async a=>{try{let{data:b}=await i.post("/auth/password-reset/",{email:a});return{success:!0,message:b?.message||"Password reset email sent successfully."}}catch(a){return{success:!1,message:a?.response?.data?.message||a?.response?.data?.detail||"Failed to send reset email. Please try again."}}},y=async(a,b,c,d)=>{try{let e=await i.post("/auth/password-reset/confirm/",{uid:a,token:b,new_password:c,confirm_password:d});return{success:!0,message:e.data.message}}catch(a){return{success:!1,message:a?.response?.data?.message||"Failed to reset password. Please try again."}}},z=()=>!!(j&&r(j)),A=async()=>{try{let a=await d.A.get(`${h}/health/`,{timeout:3e3,headers:{"Content-Type":"application/json"}});return m=!0,n="maintenance"===a.data.status,o="maintenance"===a.data.status&&a.data.maintenance||null,Date.now(),{message:n?"Server is in maintenance mode":"Server is reachable",isAuthenticated:z(),serverError:!1,maintenanceMode:n,maintenanceInfo:o}}catch(a){if(Date.now(),a.response?.status===503)return m=!0,n=!0,o=a.response?.data?.maintenance||a.response?.data||null,{message:"Server is in maintenance mode",isAuthenticated:z(),serverError:!1,maintenanceMode:!0,maintenanceInfo:o};return m=!1,n=!1,o=null,{message:"Server is unreachable",isAuthenticated:z(),serverError:!0,maintenanceMode:!1}}};i.interceptors.request.use(a=>(j&&r(j)&&(a.headers.Authorization=`Bearer ${j}`),a),a=>Promise.reject(a)),i.interceptors.response.use(a=>(m=!0,n=!1,o=null,Date.now(),a),async a=>{if("ECONNABORTED"===a.code||"ERR_NETWORK"===a.code||a.message?.includes("timeout")||a.message?.includes("Network Error")||!a.response)m=!1,Date.now();else if(a.response?.status===503){m=!0,n=!0;let b=a.response?.data;o=b?.maintenance||b||null,Date.now()}return a.response?.status===401&&s(),Promise.reject(a)});let B=()=>{let[a,b]=(0,f.useState)(l),[c,d]=(0,f.useState)(!0),[e,h]=(0,f.useState)(!1),[i,j]=(0,f.useState)(!1),[k,p]=(0,f.useState)(!1),[q,r]=(0,f.useState)(null),s=(0,g.useRouter)(),x=(0,f.useRef)(!0);(0,f.useEffect)(()=>()=>{x.current=!1},[]),(0,f.useEffect)(()=>{(async()=>{if(x.current)try{let a=await A();if(a.maintenanceMode){p(!0),r(a.maintenanceInfo||null),j(!1),h(!0),d(!1),s.push("/maintenance");return}if(a.serverError){j(!0),p(!1),r(null),h(!0),d(!1),s.push("/server-unreachable");return}let c=z(),e=l;if(c&&e){b(e),h(!0),d(!1),j(!1),p(!1),r(null);return}if(c&&!e)try{let a=await u();x.current&&(b(a),j(!m),p(n),r(o))}catch(a){j(!m),p(n),r(o)}x.current&&(h(!0),d(!1),j(!m),p(n),r(o))}catch(a){x.current&&(h(!0),d(!1),j(!0),p(n),r(o))}})()},[s]);let y=async(a,c)=>{let d=await v(a,c);if(d.serverError)return j(!0),p(!1),r(null),s.push("/server-unreachable"),d;if(d.maintenanceMode)return j(!1),p(!0),r(d.maintenanceInfo||null),s.push("/maintenance"),d;if("Login successful"===d.message&&d.user&&x.current){b(d.user),j(!1),p(!1),r(null);let a=t(d.user.role);s.push(a)}return d},B=async()=>{await w(),x.current&&(b(null),p(!1),r(null))},C=async()=>{d(!0);let a=await A();if(a.serverError)j(!0),p(!1),r(null),s.push("/server-unreachable");else if(a.maintenanceMode)j(!1),p(!0),r(a.maintenanceInfo||null),s.push("/maintenance");else if("Server is reachable"===a.message&&x.current&&(j(!1),p(!1),r(null),z()))try{let a=await u();b(a)}catch(a){console.warn("Failed to refresh user data after reconnection")}return x.current&&d(!1),a},D=async()=>{let a=await u();return x.current&&(b(a),j(!m),p(n),r(o)),a};return{user:a,isAuthenticated:z(),isLoading:c,authChecked:e,serverUnreachable:i,maintenanceMode:k,maintenanceDetails:q,login:y,logout:B,retryConnection:C,fetchUser:D,getRoleBasedRedirectUrl:t}},C=i}};