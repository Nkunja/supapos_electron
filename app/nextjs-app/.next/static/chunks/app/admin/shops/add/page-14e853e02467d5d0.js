(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2432],{44579:(e,s,a)=>{"use strict";a.r(s),a.d(s,{default:()=>B});var t=a(95155),r=a(12115),l=a(35695),i=a(88482),n=a(97168),c=a(89852),d=a(82714),o=a(90088),m=a(49026),x=a(95139),h=a(47655),p=a(53999);function u(e){let{className:s,children:a,...r}=e;return(0,t.jsxs)(h.bL,{"data-slot":"scroll-area",className:(0,p.cn)("relative",s),...r,children:[(0,t.jsx)(h.LM,{"data-slot":"scroll-area-viewport",className:"focus-visible:ring-ring/50 size-full rounded-[inherit] transition-[color,box-shadow] outline-none focus-visible:ring-[3px] focus-visible:outline-1",children:a}),(0,t.jsx)(b,{}),(0,t.jsx)(h.OK,{})]})}function b(e){let{className:s,orientation:a="vertical",...r}=e;return(0,t.jsx)(h.VM,{"data-slot":"scroll-area-scrollbar",orientation:a,className:(0,p.cn)("flex touch-none p-px transition-colors select-none","vertical"===a&&"h-full w-2.5 border-l border-l-transparent","horizontal"===a&&"h-2.5 flex-col border-t border-t-transparent",s),...r,children:(0,t.jsx)(h.lr,{"data-slot":"scroll-area-thumb",className:"bg-border relative flex-1 rounded-full"})})}var g=a(76037),j=a(35169),v=a(5937),N=a(1243),f=a(40646),y=a(23227),_=a(81586),w=a(4516),k=a(79264),A=a(19420),C=a(50675),S=a(17580),F=a(71007),z=a(28883),P=a(84616),J=a(6874),E=a.n(J),R=a(38543),T=a(5540),$=a(71158);function B(){let e=(0,l.useRouter)(),[s,a]=(0,r.useState)(!1),[h,p]=(0,r.useState)(""),[b,J]=(0,r.useState)(""),[B,L]=(0,r.useState)([]),[I,K]=(0,r.useState)(!0),[M,O]=(0,r.useState)({name:"",address:"",po_box:"",phone_number:"",tel_number:"",kra_pin:"",salespersons:[],is_active:!0}),Z=async()=>{try{K(!0);let e=await (0,$.lo)(),s=[];Array.isArray(e)?s=e.filter(e=>"salesperson"===e.role&&e.is_active):e.results&&(s=e.results.filter(e=>"salesperson"===e.role&&e.is_active)),L(s)}catch(e){console.error("Error fetching users:",e),R.oR.error("Failed to load salespersons")}finally{K(!1)}};(0,r.useEffect)(()=>{Z()},[]);let q=(e,s)=>{O(a=>({...a,[e]:s})),h&&p(""),b&&J("")},U=(e,s)=>{O(a=>({...a,salespersons:s?[...a.salespersons,e]:a.salespersons.filter(s=>s!==e)})),h&&p(""),b&&J("")},V=async()=>{if((()=>{if(!M.name.trim())return p("Shop name is required"),!1;if(!M.address.trim())return p("Address is required"),!1;if(M.kra_pin.trim()){let e=M.kra_pin.replace(/\s/g,"").toUpperCase();if(11!==e.length||!e.startsWith("P"))return p("KRA PIN must be 11 characters long and start with P (e.g., P051234567M)"),!1}return!0})()){a(!0),p(""),J("");try{let s={name:M.name.trim(),address:M.address.trim(),po_box:M.po_box.trim()||"",phone_number:M.phone_number.trim()||"",tel_number:M.tel_number.trim()||"",kra_pin:M.kra_pin.trim().toUpperCase()||"",salespersons:M.salespersons,is_active:M.is_active};await (0,T.dG)(s),J('Shop "'.concat(M.name,'" created successfully!')),O({name:"",address:"",po_box:"",phone_number:"",tel_number:"",kra_pin:"",salespersons:[],is_active:!0}),setTimeout(()=>{e.push("/admin/shops")},2e3)}catch(e){p(e instanceof Error?e.message:"Failed to create shop. Please try again.")}finally{a(!1)}}};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("div",{className:"mb-6",children:(0,t.jsx)(E(),{href:"/admin/shops",children:(0,t.jsxs)(n.$,{variant:"outline",size:"sm",children:[(0,t.jsx)(j.A,{className:"h-4 w-4 mr-2"}),"Back to Shops"]})})}),(0,t.jsx)("div",{className:"w-full mx-auto",children:(0,t.jsxs)(i.Zp,{className:"shadow-lg",children:[(0,t.jsxs)(i.aR,{children:[(0,t.jsxs)(i.ZB,{className:"flex items-center space-x-2",children:[(0,t.jsx)(v.A,{className:"h-5 w-5"}),(0,t.jsx)("span",{children:"Add New Shop"})]}),(0,t.jsx)(i.BT,{children:"Create a new business shop and assign salespersons to manage it"})]}),(0,t.jsxs)(i.Wu,{children:[h&&(0,t.jsxs)(m.Fc,{variant:"destructive",className:"mb-6",children:[(0,t.jsx)(N.A,{className:"h-4 w-4"}),(0,t.jsx)(m.TN,{children:h})]}),b&&(0,t.jsxs)(m.Fc,{className:"mb-6 border-green-200 bg-green-50",children:[(0,t.jsx)(f.A,{className:"h-4 w-4 text-green-600"}),(0,t.jsx)(m.TN,{className:"text-green-800",children:b})]}),(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("div",{className:"border-b pb-2",children:[(0,t.jsx)("h3",{className:"text-lg font-medium text-gray-900",children:"Shop Information"}),(0,t.jsx)("p",{className:"text-sm text-gray-600",children:"Basic details about the shop"})]}),(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(d.J,{htmlFor:"name",className:"text-sm font-medium",children:"Shop Name *"}),(0,t.jsxs)("div",{className:"relative",children:[(0,t.jsx)(y.A,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),(0,t.jsx)(c.p,{id:"name",type:"text",placeholder:"Enter shop name",value:M.name,onChange:e=>q("name",e.target.value),className:"pl-10",disabled:s})]})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(d.J,{htmlFor:"kra_pin",className:"text-sm font-medium",children:"KRA PIN"}),(0,t.jsxs)("div",{className:"relative",children:[(0,t.jsx)(_.A,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),(0,t.jsx)(c.p,{id:"kra_pin",type:"text",placeholder:"e.g., P051234567M",value:M.kra_pin,onChange:e=>q("kra_pin",e.target.value),className:"pl-10",disabled:s,maxLength:11})]}),(0,t.jsx)("p",{className:"text-xs text-gray-500",children:"Kenya Revenue Authority PIN (optional)"})]})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(d.J,{htmlFor:"address",className:"text-sm font-medium",children:"Address *"}),(0,t.jsxs)("div",{className:"relative",children:[(0,t.jsx)(w.A,{className:"absolute left-3 top-3 h-4 w-4 text-gray-400"}),(0,t.jsx)("textarea",{id:"address",placeholder:"Enter complete shop address",value:M.address,onChange:e=>q("address",e.target.value),className:"w-full pl-10 pr-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 min-h-[80px] resize-none",disabled:s})]})]}),(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(d.J,{htmlFor:"po_box",className:"text-sm font-medium",children:"P.O. Box"}),(0,t.jsxs)("div",{className:"relative",children:[(0,t.jsx)(k.A,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),(0,t.jsx)(c.p,{id:"po_box",type:"text",placeholder:"e.g., 12345",value:M.po_box,onChange:e=>q("po_box",e.target.value),className:"pl-10",disabled:s})]})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(d.J,{htmlFor:"phone_number",className:"text-sm font-medium",children:"Phone Number"}),(0,t.jsxs)("div",{className:"relative",children:[(0,t.jsx)(A.A,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),(0,t.jsx)(c.p,{id:"phone_number",type:"tel",placeholder:"e.g., +254 700 123456",value:M.phone_number,onChange:e=>q("phone_number",e.target.value),className:"pl-10",disabled:s})]})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(d.J,{htmlFor:"tel_number",className:"text-sm font-medium",children:"Telephone Number"}),(0,t.jsxs)("div",{className:"relative",children:[(0,t.jsx)(C.A,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),(0,t.jsx)(c.p,{id:"tel_number",type:"tel",placeholder:"e.g., 020 1234567",value:M.tel_number,onChange:e=>q("tel_number",e.target.value),className:"pl-10",disabled:s})]})]})]}),(0,t.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,t.jsx)(o.d,{id:"is_active",checked:M.is_active,onCheckedChange:e=>q("is_active",e),disabled:s}),(0,t.jsx)(d.J,{htmlFor:"is_active",className:"text-sm font-medium",children:"Active Shop"}),(0,t.jsx)("span",{className:"text-xs text-gray-500 ml-2",children:"(Shop will be available for operations)"})]})]}),(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("div",{className:"border-b pb-2",children:[(0,t.jsx)("h3",{className:"text-lg font-medium text-gray-900",children:"Assign Salespersons"}),(0,t.jsx)("p",{className:"text-sm text-gray-600",children:"Select salespersons to manage this shop"})]}),(0,t.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[(0,t.jsxs)("div",{className:"space-y-3",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)(d.J,{className:"text-sm font-medium",children:["Available Salespersons (",B.length,")"]}),(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsx)(n.$,{type:"button",variant:"outline",size:"sm",onClick:()=>{O(e=>({...e,salespersons:B.map(e=>e.id)}))},disabled:s||I||0===B.length,className:"text-xs",children:"Select All"}),(0,t.jsx)(n.$,{type:"button",variant:"outline",size:"sm",onClick:()=>{O(e=>({...e,salespersons:[]}))},disabled:s||0===M.salespersons.length,className:"text-xs",children:"Clear All"})]})]}),(0,t.jsx)(i.Zp,{className:"border-gray-200",children:(0,t.jsx)(u,{className:"h-[300px] p-4",children:I?(0,t.jsxs)("div",{className:"text-center py-8",children:[(0,t.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto mb-4"}),(0,t.jsx)("p",{className:"text-sm text-gray-500",children:"Loading salespersons..."})]}):0===B.length?(0,t.jsxs)("div",{className:"text-center py-8",children:[(0,t.jsx)(S.A,{className:"h-12 w-12 mx-auto mb-4 text-gray-300"}),(0,t.jsx)("p",{className:"text-sm text-gray-500",children:"No active salespersons available"})]}):(0,t.jsx)("div",{className:"space-y-3",children:B.map(e=>(0,t.jsxs)("div",{className:"flex items-start space-x-3 p-3 rounded-lg border border-gray-100 hover:bg-gray-50 transition-colors",children:[(0,t.jsx)(x.S,{id:"salesperson-".concat(e.id),checked:M.salespersons.includes(e.id),onCheckedChange:s=>U(e.id,s),disabled:s}),(0,t.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(F.A,{className:"h-4 w-4 text-gray-500"}),(0,t.jsx)(d.J,{htmlFor:"salesperson-".concat(e.id),className:"text-sm font-medium cursor-pointer",children:e.full_name})]}),(0,t.jsxs)("div",{className:"flex items-center gap-2 mt-1",children:[(0,t.jsx)(z.A,{className:"h-3 w-3 text-gray-400"}),(0,t.jsx)("span",{className:"text-xs text-gray-500",children:e.email})]})]})]},e.id))})})})]}),(0,t.jsxs)("div",{className:"space-y-3",children:[(0,t.jsxs)(d.J,{className:"text-sm font-medium",children:["Selected Salespersons (",M.salespersons.length,")"]}),(0,t.jsx)(i.Zp,{className:"border-gray-200",children:(0,t.jsx)("div",{className:"p-4",children:0===M.salespersons.length?(0,t.jsxs)("div",{className:"text-center py-8",children:[(0,t.jsx)(S.A,{className:"h-12 w-12 mx-auto mb-4 text-gray-300"}),(0,t.jsx)("p",{className:"text-sm text-gray-500",children:"No salespersons selected"}),(0,t.jsx)("p",{className:"text-xs text-gray-400 mt-1",children:"Select from the list to assign salespersons to this shop"})]}):(0,t.jsxs)("div",{className:"space-y-3",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2 mb-3",children:[(0,t.jsx)(S.A,{className:"h-4 w-4 text-blue-600"}),(0,t.jsxs)("span",{className:"text-sm font-medium text-blue-700",children:[M.salespersons.length," salesperson(s) selected"]})]}),(0,t.jsx)(g.w,{}),(0,t.jsx)(u,{className:"max-h-[240px]",children:(0,t.jsx)("div",{className:"space-y-2",children:B.filter(e=>M.salespersons.includes(e.id)).map(e=>(0,t.jsxs)("div",{className:"flex items-center gap-3 p-2 bg-blue-50 rounded-lg",children:[(0,t.jsx)(F.A,{className:"h-3 w-3 text-blue-600"}),(0,t.jsxs)("div",{className:"flex-1",children:[(0,t.jsx)("p",{className:"text-sm font-medium text-blue-900",children:e.full_name}),(0,t.jsx)("p",{className:"text-xs text-blue-600",children:e.email})]}),(0,t.jsx)(n.$,{type:"button",variant:"ghost",size:"sm",onClick:()=>U(e.id,!1),className:"h-6 w-6 p-0 text-blue-600 hover:text-blue-800",disabled:s,children:"\xd7"})]},e.id))})})]})})})]})]})]}),(0,t.jsxs)("div",{className:"flex flex-col sm:flex-row gap-4 pt-6 border-t",children:[(0,t.jsx)(n.$,{type:"button",className:"flex-1 bg-blue-600 hover:bg-blue-700 h-12",disabled:s,onClick:V,children:s?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"Creating Shop..."]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(P.A,{className:"h-4 w-4 mr-2"}),"Create Shop"]})}),(0,t.jsx)(n.$,{type:"button",variant:"outline",className:"flex-1 h-12",onClick:()=>{e.push("/admin/shops")},disabled:s,children:"Cancel"})]})]})]})]})})]})}},45640:(e,s,a)=>{Promise.resolve().then(a.bind(a,44579))},49026:(e,s,a)=>{"use strict";a.d(s,{Fc:()=>n,TN:()=>c});var t=a(95155);a(12115);var r=a(74466),l=a(53999);let i=(0,r.F)("relative w-full rounded-lg border px-4 py-3 text-sm grid has-[>svg]:grid-cols-[calc(var(--spacing)*4)_1fr] grid-cols-[0_1fr] has-[>svg]:gap-x-3 gap-y-0.5 items-start [&>svg]:size-4 [&>svg]:translate-y-0.5 [&>svg]:text-current",{variants:{variant:{default:"bg-card text-card-foreground",destructive:"text-destructive bg-card [&>svg]:text-current *:data-[slot=alert-description]:text-destructive/90"}},defaultVariants:{variant:"default"}});function n(e){let{className:s,variant:a,...r}=e;return(0,t.jsx)("div",{"data-slot":"alert",role:"alert",className:(0,l.cn)(i({variant:a}),s),...r})}function c(e){let{className:s,...a}=e;return(0,t.jsx)("div",{"data-slot":"alert-description",className:(0,l.cn)("text-muted-foreground col-start-2 grid justify-items-start gap-1 text-sm [&_p]:leading-relaxed",s),...a})}},76037:(e,s,a)=>{"use strict";a.d(s,{w:()=>i});var t=a(95155);a(12115);var r=a(87489),l=a(53999);function i(e){let{className:s,orientation:a="horizontal",decorative:i=!0,...n}=e;return(0,t.jsx)(r.b,{"data-slot":"separator",decorative:i,orientation:a,className:(0,l.cn)("bg-border shrink-0 data-[orientation=horizontal]:h-px data-[orientation=horizontal]:w-full data-[orientation=vertical]:h-full data-[orientation=vertical]:w-px",s),...n})}},95139:(e,s,a)=>{"use strict";a.d(s,{S:()=>n});var t=a(95155);a(12115);var r=a(76981),l=a(5196),i=a(53999);function n(e){let{className:s,...a}=e;return(0,t.jsx)(r.bL,{"data-slot":"checkbox",className:(0,i.cn)("peer border-input dark:bg-input/30 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground dark:data-[state=checked]:bg-primary data-[state=checked]:border-primary focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive size-4 shrink-0 rounded-[4px] border shadow-xs transition-shadow outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50",s),...a,children:(0,t.jsx)(r.C1,{"data-slot":"checkbox-indicator",className:"flex items-center justify-center text-current transition-none",children:(0,t.jsx)(l.A,{className:"size-3.5"})})})}}},e=>{e.O(0,[6586,4277,8543,6373,6874,8440,1778,6924,8441,5964,7358],()=>e(e.s=45640)),_N_E=e.O()}]);