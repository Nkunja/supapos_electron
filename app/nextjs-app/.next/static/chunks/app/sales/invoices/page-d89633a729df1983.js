(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7366],{9253:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>q});var a=t(95155),n=t(12115),r=t(38543),l=t(51162),i=t(38125),c=t(88482),d=t(66932),o=t(53904),m=t(23562),x=t(54416);let u=[{label:"Today",value:"1",description:"Last 24 hours"},{label:"7 Days",value:"last_7_days",description:"Past week"},{label:"30 Days",value:"30",description:"Last 30 days"},{label:"45 Days",value:"45",description:"Last 45 days"},{label:"90 Days",value:"90",description:"Last 3 months"}];function h(e){let{selectedPeriod:s,setSelectedPeriod:n,showCustomRange:r,setShowCustomRange:l,startDate:i,setStartDate:h,endDate:p,setEndDate:j,isCustomRange:f,setIsCustomRange:g,filterLoading:N,filterInvoicesByPeriod:v,filterInvoicesByDateRange:b}=e,{toast:y}=t(44924),w=()=>{l(!r),r&&(h(""),j(""),f&&(g(!1),n("30"),v("30")))};return(0,a.jsx)(c.Zp,{className:"bg-white/80 backdrop-blur-sm border border-gray-200/50 shadow-lg",children:(0,a.jsxs)(c.Wu,{className:"p-4",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3 mb-3",children:[(0,a.jsx)(d.A,{className:"h-4 w-4 text-gray-600"}),(0,a.jsx)("span",{className:"text-sm font-medium text-gray-700",children:"Filter by Date"}),N&&(0,a.jsx)(o.A,{className:"h-3 w-3 animate-spin text-blue-600"})]}),f&&(0,a.jsx)("div",{className:"mb-3 p-2 bg-blue-50 border border-blue-200 rounded-lg",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(m.A,{className:"h-4 w-4 text-blue-600"}),(0,a.jsxs)("span",{className:"text-sm font-medium text-blue-800",children:["Custom Range: ",(()=>{if(i&&p){let e=new Date(i).toLocaleDateString(),s=new Date(p).toLocaleDateString();return"".concat(e," - ").concat(s)}return""})()]})]}),(0,a.jsx)("button",{onClick:()=>{h(""),j(""),g(!1),n("30"),l(!1),v("30")},className:"p-1 hover:bg-blue-100 rounded transition-colors",title:"Clear custom range",children:(0,a.jsx)(x.A,{className:"h-3 w-3 text-blue-600"})})]})}),(0,a.jsxs)("div",{className:"flex flex-wrap gap-2 mb-3",children:[u.map(e=>(0,a.jsxs)("button",{onClick:()=>{var s;n(s=e.value),g(!1),l(!1),v(s)},disabled:N,className:"\n                px-3 py-2 rounded-lg text-sm font-medium transition-all duration-200\n                ".concat(s===e.value&&!f?"bg-gradient-to-r from-blue-500 to-purple-600 text-white shadow-md transform scale-105":"bg-gray-100 hover:bg-gray-200 text-gray-700 hover:shadow-sm","\n                ").concat(N?"opacity-50 cursor-not-allowed":"hover:scale-105","\n              "),title:e.description,children:[N&&s===e.value&&!f&&(0,a.jsx)(o.A,{className:"h-3 w-3 mr-1 animate-spin inline"}),e.label]},e.value)),(0,a.jsxs)("button",{onClick:w,disabled:N,className:"\n              px-3 py-2 rounded-lg text-sm font-medium transition-all duration-200 flex items-center gap-1\n              ".concat(r||f?"bg-gradient-to-r from-green-500 to-emerald-600 text-white shadow-md":"bg-gray-100 hover:bg-gray-200 text-gray-700 hover:shadow-sm","\n              ").concat(N?"opacity-50 cursor-not-allowed":"hover:scale-105","\n            "),title:"Select custom date range",children:[(0,a.jsx)(m.A,{className:"h-3 w-3"}),"Custom Range"]})]}),r&&(0,a.jsx)("div",{className:"border-t pt-3 mt-3",children:(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-xs font-medium text-gray-600 mb-1",children:"Start Date"}),(0,a.jsx)("input",{type:"date",value:i,onChange:e=>h(e.target.value),className:"w-full px-3 py-2 text-sm border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-xs font-medium text-gray-600 mb-1",children:"End Date"}),(0,a.jsx)("input",{type:"date",value:p,onChange:e=>j(e.target.value),className:"w-full px-3 py-2 text-sm border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]})]}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)("button",{onClick:()=>{if(i&&p){if(new Date(i)>new Date(p))return void y.error("Start date cannot be later than end date");g(!0),n("custom"),l(!1),b(i,p)}else y.error("Please select both start and end dates")},disabled:!i||!p||N,className:"flex-1 bg-gradient-to-r from-blue-500 to-purple-600 text-white px-4 py-2 rounded-md text-sm font-medium hover:shadow-md transition-all disabled:opacity-50 disabled:cursor-not-allowed",children:N?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(o.A,{className:"h-3 w-3 mr-1 animate-spin inline"}),"Applying..."]}):"Apply Range"}),(0,a.jsx)("button",{onClick:w,className:"px-4 py-2 border border-gray-300 text-gray-700 rounded-md text-sm font-medium hover:bg-gray-50 transition-colors",children:"Cancel"})]})]})})]})})}var p=t(55868),j=t(33109),f=t(79397),g=t(87712);function N(e){let{filteredTotals:s,formatCurrency:t}=e;return(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[(0,a.jsx)(c.Zp,{className:"bg-gradient-to-br from-blue-50 to-blue-100 border-blue-200",children:(0,a.jsx)(c.Wu,{className:"p-4",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm font-medium text-blue-600",children:"Total Sales"}),(0,a.jsx)("p",{className:"text-2xl font-bold text-blue-900",children:t(s.totalAmount)})]}),(0,a.jsx)(p.A,{className:"h-8 w-8 text-blue-600"})]})})}),(0,a.jsx)(c.Zp,{className:"bg-gradient-to-br from-purple-50 to-purple-100 border-purple-200",children:(0,a.jsx)(c.Wu,{className:"p-4",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm font-medium text-purple-600",children:"Tax Collected"}),(0,a.jsx)("p",{className:"text-2xl font-bold text-purple-900",children:t(s.totalTax)})]}),(0,a.jsx)(j.A,{className:"h-8 w-8 text-purple-600"})]})})}),(0,a.jsx)(c.Zp,{className:"bg-gradient-to-br from-orange-50 to-orange-100 border-orange-200",children:(0,a.jsx)(c.Wu,{className:"p-4",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm font-medium text-orange-600",children:"Invoice Count"}),(0,a.jsx)("p",{className:"text-2xl font-bold text-orange-900",children:s.invoiceCount})]}),(0,a.jsx)(f.A,{className:"h-8 w-8 text-orange-600"})]})})}),s.totalDiscount>0&&(0,a.jsx)(c.Zp,{className:"bg-gradient-to-r from-red-50 to-pink-50 border-red-200",children:(0,a.jsx)(c.Wu,{className:"p-4",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm font-medium text-red-600",children:"Total Discounts"}),(0,a.jsx)("p",{className:"text-xl font-bold text-red-900",children:t(s.totalDiscount)})]}),(0,a.jsx)(g.A,{className:"h-6 w-6 text-red-600"})]})})})]})}var v=t(88524),b=t(97168),y=t(67133),w=t(51154),_=t(46308),C=t(5623),A=t(92657),k=t(71007),D=t(5937),S=t(81586),I=t(69074),E=t(88145);function Z(e){let{filteredInvoices:s,loading:t,formatCurrency:n,setSelectedInvoice:r,setViewModalOpen:l,setCreditNoteModalOpen:i}=e,d=e=>{switch(e.toLowerCase()){case"paid":case"completed":return"default";case"pending":return"secondary";case"cancelled":return"destructive";default:return"outline"}};return t?(0,a.jsx)("div",{className:"flex items-center justify-center min-h-[400px]",children:(0,a.jsxs)("div",{className:"flex flex-col items-center gap-4",children:[(0,a.jsx)(w.A,{className:"h-8 w-8 animate-spin text-primary"}),(0,a.jsx)("p",{className:"text-muted-foreground",children:"Loading all invoices..."})]})}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"block lg:hidden space-y-4",children:[s.map(e=>(0,a.jsxs)(c.Zp,{className:"overflow-hidden",children:[(0,a.jsx)(c.aR,{className:"pb-3",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)(c.ZB,{className:"text-lg flex items-center gap-2",children:[(0,a.jsx)(_.A,{className:"h-5 w-5 text-primary"}),e.invoice_number]}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(E.E,{variant:d(e.status_display),children:e.status_display}),(0,a.jsxs)(y.rI,{children:[(0,a.jsx)(y.ty,{asChild:!0,children:(0,a.jsx)(b.$,{variant:"ghost",className:"h-8 w-8 p-0",children:(0,a.jsx)(C.A,{className:"h-4 w-4"})})}),(0,a.jsxs)(y.SQ,{align:"end",children:[(0,a.jsxs)(y._2,{onClick:()=>{r(e),l(!0)},children:[(0,a.jsx)(A.A,{className:"mr-2 h-4 w-4"}),"View Invoice"]}),(0,a.jsxs)(y._2,{onClick:()=>{r(e),i(!0)},disabled:!!e.credit_note,children:[(0,a.jsx)(g.A,{className:"mr-2 h-4 w-4"}),e.credit_note?"Credit Note Issued":"Make Credit Note"]})]})]})]})]})}),(0,a.jsx)(c.Wu,{className:"space-y-3",children:(0,a.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3 text-sm",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(k.A,{className:"h-4 w-4 text-muted-foreground"}),(0,a.jsx)("span",{className:"text-muted-foreground",children:"Customer:"}),(0,a.jsx)("span",{className:"font-medium",children:e.customer_name||"Walk-in Customer"})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(D.A,{className:"h-4 w-4 text-muted-foreground"}),(0,a.jsx)("span",{className:"text-muted-foreground",children:"Shop:"}),(0,a.jsx)("span",{className:"font-medium",children:e.shop_name})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(p.A,{className:"h-4 w-4 text-muted-foreground"}),(0,a.jsx)("span",{className:"text-muted-foreground",children:"Total:"}),(0,a.jsx)("span",{className:"font-bold text-lg",children:n(e.total_amount)})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(S.A,{className:"h-4 w-4 text-muted-foreground"}),(0,a.jsx)("span",{className:"text-muted-foreground",children:"Payment:"}),(0,a.jsx)("span",{className:"font-medium",children:e.payment_method_display})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2 sm:col-span-2",children:[(0,a.jsx)(I.A,{className:"h-4 w-4 text-muted-foreground"}),(0,a.jsx)("span",{className:"text-muted-foreground",children:"Created:"}),(0,a.jsx)("span",{className:"font-medium",children:new Date(e.created_at).toLocaleString()})]})]})})]},e.id)),0===s.length&&!t&&(0,a.jsx)(c.Zp,{children:(0,a.jsxs)(c.Wu,{className:"text-center py-8",children:[(0,a.jsx)(_.A,{className:"h-12 w-12 text-muted-foreground mx-auto mb-4"}),(0,a.jsx)("p",{className:"text-muted-foreground",children:"No invoices found for the selected period"}),(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:"Try adjusting your date range"})]})})]}),(0,a.jsx)("div",{className:"hidden lg:block",children:(0,a.jsx)(c.Zp,{children:(0,a.jsxs)("div",{className:"overflow-x-auto",children:[(0,a.jsxs)(v.XI,{children:[(0,a.jsx)(v.A0,{children:(0,a.jsxs)(v.Hj,{className:"hover:bg-transparent",children:[(0,a.jsx)(v.nd,{className:"font-semibold",children:"Invoice Number"}),(0,a.jsx)(v.nd,{className:"font-semibold",children:"Customer"}),(0,a.jsx)(v.nd,{className:"font-semibold",children:"Shop"}),(0,a.jsx)(v.nd,{className:"font-semibold text-right",children:"Total Amount"}),(0,a.jsx)(v.nd,{className:"font-semibold",children:"Payment Method"}),(0,a.jsx)(v.nd,{className:"font-semibold",children:"Status"}),(0,a.jsx)(v.nd,{className:"font-semibold",children:"Created At"}),(0,a.jsx)(v.nd,{className:"font-semibold text-center",children:"Actions"})]})}),(0,a.jsx)(v.BF,{children:s.map(e=>(0,a.jsxs)(v.Hj,{className:"hover:bg-muted/50",children:[(0,a.jsx)(v.nA,{className:"font-mono font-medium",children:e.invoice_number}),(0,a.jsx)(v.nA,{children:(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(k.A,{className:"h-4 w-4 text-muted-foreground"}),e.customer_name||"Walk-in Customer"]})}),(0,a.jsx)(v.nA,{children:(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(D.A,{className:"h-4 w-4 text-muted-foreground"}),e.shop_name]})}),(0,a.jsx)(v.nA,{className:"text-right font-bold",children:n(e.total_amount)}),(0,a.jsx)(v.nA,{children:(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(S.A,{className:"h-4 w-4 text-muted-foreground"}),e.payment_method_display]})}),(0,a.jsx)(v.nA,{children:(0,a.jsx)(E.E,{variant:d(e.status_display),children:e.status_display})}),(0,a.jsx)(v.nA,{className:"text-muted-foreground",children:new Date(e.created_at).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})}),(0,a.jsx)(v.nA,{children:(0,a.jsx)("div",{className:"flex justify-center",children:(0,a.jsxs)(y.rI,{children:[(0,a.jsx)(y.ty,{asChild:!0,children:(0,a.jsx)(b.$,{variant:"ghost",className:"h-8 w-8 p-0",children:(0,a.jsx)(C.A,{className:"h-4 w-4"})})}),(0,a.jsxs)(y.SQ,{align:"end",children:[(0,a.jsxs)(y._2,{onClick:()=>{r(e),l(!0)},children:[(0,a.jsx)(A.A,{className:"mr-2 h-4 w-4"}),"View Invoice"]}),(0,a.jsxs)(y._2,{onClick:()=>{r(e),i(!0)},disabled:!!e.credit_note,children:[(0,a.jsx)(g.A,{className:"mr-2 h-4 w-4"}),e.credit_note?"Credit Note Issued":"Make Credit Note"]})]})]})})})]},e.id))})]}),0===s.length&&!t&&(0,a.jsxs)("div",{className:"text-center py-12",children:[(0,a.jsx)(_.A,{className:"h-12 w-12 text-muted-foreground mx-auto mb-4"}),(0,a.jsx)("p",{className:"text-muted-foreground",children:"No invoices found for the selected period"}),(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:"Try adjusting your date range"})]})]})})})]})}var T=t(99840),F=t(76037),R=t(15448),W=t(19420),P=t(4516),L=t(27809),B=t(37108);function M(e){var s,t;let{open:n,onOpenChange:r,selectedInvoice:l,formatCurrency:i}=e;return(0,a.jsx)(T.lG,{open:n,onOpenChange:r,children:(0,a.jsxs)(T.Cf,{className:"max-w-2xl max-h-[90vh] overflow-y-auto",children:[(0,a.jsx)(T.c7,{children:(0,a.jsxs)(T.L3,{className:"flex items-center gap-2 text-xl",children:[(0,a.jsx)(_.A,{className:"h-5 w-5"}),"Invoice Details"]})}),l&&(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,a.jsxs)(c.Zp,{children:[(0,a.jsx)(c.aR,{className:"pb-3",children:(0,a.jsx)(c.ZB,{className:"text-sm font-medium text-muted-foreground",children:"Invoice Information"})}),(0,a.jsxs)(c.Wu,{className:"space-y-2",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(R.A,{className:"h-4 w-4 text-muted-foreground"}),(0,a.jsx)("span",{className:"font-mono font-bold",children:l.invoice_number})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(I.A,{className:"h-4 w-4 text-muted-foreground"}),(0,a.jsx)("span",{className:"text-sm",children:new Date(l.created_at).toLocaleString()})]}),(0,a.jsx)("div",{className:"flex items-center gap-2",children:(0,a.jsx)(E.E,{variant:(e=>{switch(e.toLowerCase()){case"paid":case"completed":return"default";case"pending":return"secondary";case"cancelled":return"destructive";default:return"outline"}})(l.status_display),children:l.status_display})})]})]}),(0,a.jsxs)(c.Zp,{children:[(0,a.jsx)(c.aR,{className:"pb-3",children:(0,a.jsx)(c.ZB,{className:"text-sm font-medium text-muted-foreground",children:"Customer & Shop"})}),(0,a.jsxs)(c.Wu,{className:"space-y-2",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(k.A,{className:"h-4 w-4 text-muted-foreground"}),(0,a.jsx)("span",{className:"font-medium",children:l.customer_name||"Walk-in Customer"})]}),l.customer_phone&&(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(W.A,{className:"h-4 w-4 text-muted-foreground"}),(0,a.jsx)("span",{className:"text-sm",children:l.customer_phone})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(D.A,{className:"h-4 w-4 text-muted-foreground"}),(0,a.jsx)("span",{className:"font-medium",children:l.shop_name})]}),l.shop_address&&(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(P.A,{className:"h-4 w-4 text-muted-foreground"}),(0,a.jsx)("span",{className:"text-sm",children:l.shop_address})]})]})]})]}),(0,a.jsxs)(c.Zp,{children:[(0,a.jsx)(c.aR,{children:(0,a.jsxs)(c.ZB,{className:"flex items-center gap-2",children:[(0,a.jsx)(L.A,{className:"h-5 w-5"}),"Items (",(null==(s=l.items)?void 0:s.length)||0,")"]})}),(0,a.jsx)(c.Wu,{children:(0,a.jsx)("div",{className:"space-y-3",children:null==(t=l.items)?void 0:t.map((e,s)=>(0,a.jsxs)("div",{className:"flex items-center justify-between p-3 bg-muted/50 rounded-lg",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)(B.A,{className:"h-4 w-4 text-muted-foreground"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"font-medium",children:e.product_name}),(0,a.jsxs)("p",{className:"text-sm text-muted-foreground",children:["Qty: ",e.quantity," \xd7"," ",i(e.unit_price)]})]})]}),(0,a.jsxs)("div",{className:"text-right",children:[(0,a.jsx)("p",{className:"font-bold",children:i(e.total_price)}),void 0!==e.available_stock&&(0,a.jsxs)("p",{className:"text-xs text-muted-foreground",children:["Stock: ",e.available_stock]})]})]},e.id||s))})})]}),(0,a.jsxs)(c.Zp,{children:[(0,a.jsx)(c.aR,{children:(0,a.jsxs)(c.ZB,{className:"flex items-center gap-2",children:[(0,a.jsx)(p.A,{className:"h-5 w-5"}),"Payment Summary"]})}),(0,a.jsx)(c.Wu,{children:(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("span",{children:"Subtotal:"}),(0,a.jsx)("span",{children:i(l.subtotal)})]}),Number(l.tax_amount)>0&&(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("span",{children:"Tax:"}),(0,a.jsx)("span",{children:i(l.tax_amount)})]}),Number(l.discount_amount)>0&&(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("span",{children:"Discount:"}),(0,a.jsxs)("span",{className:"text-green-600",children:["-",i(l.discount_amount)]})]}),(0,a.jsx)(F.w,{}),(0,a.jsxs)("div",{className:"flex justify-between font-bold text-lg",children:[(0,a.jsx)("span",{children:"Total:"}),(0,a.jsx)("span",{children:i(l.total_amount)})]}),(0,a.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,a.jsx)("span",{children:"Amount Paid:"}),(0,a.jsx)("span",{className:"text-green-600",children:i(l.amount_paid)})]}),Number(l.change_amount)>0&&(0,a.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,a.jsx)("span",{children:"Change:"}),(0,a.jsx)("span",{children:i(l.change_amount)})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2 mt-2",children:[(0,a.jsx)(S.A,{className:"h-4 w-4 text-muted-foreground"}),(0,a.jsx)("span",{className:"text-sm font-medium",children:l.payment_method_display})]})]})})]}),l.notes&&(0,a.jsxs)(c.Zp,{children:[(0,a.jsx)(c.aR,{children:(0,a.jsx)(c.ZB,{className:"text-sm font-medium text-muted-foreground",children:"Notes"})}),(0,a.jsx)(c.Wu,{children:(0,a.jsx)("p",{className:"text-sm",children:l.notes})})]})]})]})})}var O=t(89852),Q=t(82714),V=t(57434);function $(e){var s;let{open:t,onOpenChange:n,selectedInvoice:r,creditNoteNotes:l,setCreditNoteNotes:i,creatingCreditNote:d,handleCreateCreditNote:o,formatCurrency:m}=e;return(0,a.jsx)(T.lG,{open:t,onOpenChange:n,children:(0,a.jsxs)(T.Cf,{className:"max-w-2xl max-h-[90vh] overflow-y-auto",children:[(0,a.jsx)(T.c7,{children:(0,a.jsxs)(T.L3,{className:"flex items-center gap-2",children:[(0,a.jsx)(V.A,{className:"h-5 w-5"}),"Create Credit Note"]})}),r&&(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)(c.Zp,{children:[(0,a.jsx)(c.aR,{className:"pb-3",children:(0,a.jsx)(c.ZB,{className:"text-lg",children:"Invoice Summary"})}),(0,a.jsx)(c.Wu,{children:(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-muted-foreground",children:"Invoice Number:"}),(0,a.jsx)("p",{className:"font-mono font-bold",children:r.invoice_number})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-muted-foreground",children:"Customer:"}),(0,a.jsx)("p",{className:"font-medium",children:r.customer_name||"Walk-in Customer"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-muted-foreground",children:"Total Amount:"}),(0,a.jsx)("p",{className:"font-bold text-lg",children:m(r.total_amount)})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-muted-foreground",children:"Payment Method:"}),(0,a.jsx)("p",{className:"font-medium",children:r.payment_method_display})]})]})})]}),(0,a.jsxs)(c.Zp,{children:[(0,a.jsx)(c.aR,{children:(0,a.jsxs)(c.ZB,{className:"flex items-center gap-2",children:[(0,a.jsx)(B.A,{className:"h-5 w-5"}),"Items to Credit"]})}),(0,a.jsx)(c.Wu,{children:(0,a.jsxs)("div",{className:"space-y-2",children:[null==(s=r.items)?void 0:s.map((e,s)=>(0,a.jsxs)("div",{className:"flex justify-between items-center p-2 bg-muted/30 rounded",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"font-medium",children:e.product_name}),(0,a.jsxs)("p",{className:"text-sm text-muted-foreground",children:["Qty: ",e.quantity," \xd7"," ",m(e.unit_price)]})]}),(0,a.jsx)("p",{className:"font-bold",children:m(e.total_price)})]},e.id||s)),(0,a.jsx)(F.w,{className:"my-2"}),(0,a.jsxs)("div",{className:"flex justify-between font-bold",children:[(0,a.jsx)("span",{children:"Credit Total:"}),(0,a.jsx)("span",{className:"text-red-600",children:m(r.total_amount)})]})]})})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)(Q.J,{htmlFor:"credit-notes",className:"text-sm font-medium",children:"Notes (Optional)"}),(0,a.jsx)(O.p,{id:"credit-notes",value:l,onChange:e=>i(e.target.value),placeholder:"Enter reason for credit note or additional notes",className:"mt-1"})]})]}),(0,a.jsxs)(T.Es,{className:"gap-2 sm:gap-0",children:[(0,a.jsx)(b.$,{variant:"outline",onClick:()=>n(!1),disabled:d,children:"Cancel"}),(0,a.jsxs)(b.$,{onClick:o,disabled:d,className:"bg-red-600 hover:bg-red-700",children:[d&&(0,a.jsx)(w.A,{className:"h-4 w-4 mr-2 animate-spin"}),"Create Credit Note"]})]})]})})}function q(){let[e,s]=(0,n.useState)([]),[t,c]=(0,n.useState)([]),[d,o]=(0,n.useState)(!0),[m,x]=(0,n.useState)(!1),[u,p]=(0,n.useState)(!1),[j,f]=(0,n.useState)(!1),[g,v]=(0,n.useState)(null),[b,y]=(0,n.useState)(""),[w,C]=(0,n.useState)(!1),[A,k]=(0,n.useState)("30"),[D,S]=(0,n.useState)(!1),[I,E]=(0,n.useState)(""),[T,F]=(0,n.useState)(""),[R,W]=(0,n.useState)(!1),P=(0,n.useMemo)(()=>{let e={totalAmount:0,totalPaid:0,totalTax:0,totalDiscount:0,invoiceCount:t.length};return t.forEach(s=>{e.totalAmount+=Number(s.total_amount)||0,e.totalPaid+=Number(s.amount_paid)||0,e.totalTax+=Number(s.tax_amount)||0,e.totalDiscount+=Number(s.discount_amount)||0}),e},[t]);(0,n.useEffect)(()=>{(async()=>{try{let e=await (0,l.Cb)();s(e.results),c(e.results),o(!1)}catch(e){console.error("Error fetching invoices:",e),r.oR.error("Failed to load invoices"),o(!1)}})()},[]);let L=e=>new Intl.NumberFormat("en-KE",{style:"currency",currency:"KES"}).format(Number(e)),B=async()=>{if(g){C(!0);try{let t=await (0,i._M)({invoice_id:g.id,notes:b});if(t&&t.credit_note){r.oR.success("Credit note ".concat(t.credit_note.credit_note_number," created successfully"));let e=await (0,l.Cb)();s(e.results),R&&I&&T?Q(I,T):O(A),p(!1),y(""),v(null)}else{var e;let s=(null==t||null==(e=t.invoice)?void 0:e[0])||(null==t?void 0:t.message)||"Failed to create credit note";r.oR.error(s)}}catch(e){console.error("Error creating credit note:",e),r.oR.error("Failed to create credit note")}finally{C(!1)}}},O=s=>{let t;x(!0);let a=new Date;switch(s){case"1":t=new Date(a.getFullYear(),a.getMonth(),a.getDate());break;case"last_7_days":t=new Date(a.getTime()-6048e5);break;case"30":t=new Date(a.getTime()-2592e6);break;case"45":t=new Date(a.getTime()-3888e6);break;case"90":t=new Date(a.getTime()-7776e6);break;default:c(e),x(!1);return}let n=e.filter(e=>new Date(e.created_at)>=t);setTimeout(()=>{c(n),x(!1)},300)},Q=(s,t)=>{x(!0);let a=new Date(s),n=new Date(t);n.setHours(23,59,59,999);let r=e.filter(e=>{let s=new Date(e.created_at);return s>=a&&s<=n});setTimeout(()=>{c(r),x(!1)},300)};return(0,a.jsxs)("div",{className:"container mx-auto p-4 sm:p-6 lg:p-8 space-y-6",children:[(0,a.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h1",{className:"text-3xl font-bold tracking-tight",children:"Invoices"}),(0,a.jsx)("p",{className:"text-muted-foreground",children:"Manage and track all your invoices"})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[(0,a.jsx)(_.A,{className:"h-4 w-4"}),(0,a.jsxs)("span",{children:[t.length," of ",e.length," invoices"]})]})]}),(0,a.jsx)(N,{filteredTotals:P,formatCurrency:L}),(0,a.jsx)(h,{selectedPeriod:A,setSelectedPeriod:k,showCustomRange:D,setShowCustomRange:S,startDate:I,setStartDate:E,endDate:T,setEndDate:F,isCustomRange:R,setIsCustomRange:W,filterLoading:m,filterInvoicesByPeriod:O,filterInvoicesByDateRange:Q}),(0,a.jsx)(Z,{filteredInvoices:t,loading:d,formatCurrency:L,setSelectedInvoice:v,setViewModalOpen:f,setCreditNoteModalOpen:p}),(0,a.jsx)(M,{open:j,onOpenChange:f,selectedInvoice:g,formatCurrency:L}),(0,a.jsx)($,{open:u,onOpenChange:p,selectedInvoice:g,creditNoteNotes:b,setCreditNoteNotes:y,creatingCreditNote:w,handleCreateCreditNote:B,formatCurrency:L})]})}},15932:(e,s,t)=>{Promise.resolve().then(t.bind(t,9253))},39740:(e,s,t)=>{"use strict";t.d(s,{t:()=>r}),t(8102);var a=t(61778);let n="".concat("https://supa.sirnkunja.co.ke/","api/invoices/sales_summary/?period_days=30"),r=async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"30";arguments.length>1&&void 0!==arguments[1]&&arguments[1];try{return console.log("\uD83D\uDD04 Fetching sales summary from API for ".concat(e," days")),(await a.default.get("".concat(n,"?period_days=").concat(e))).data}catch(e){throw Error("Failed to fetch sales summary.")}}},51162:(e,s,t)=>{"use strict";t.d(s,{Aq:()=>u,Cb:()=>m,de:()=>x,my:()=>o,sV:()=>d}),t(8102);var a=t(61778);let n="".concat("https://supa.sirnkunja.co.ke/","api/invoices/"),r=async e=>{try{let s=new URLSearchParams;(null==e?void 0:e.page)&&s.append("page",e.page),(null==e?void 0:e.search)&&s.append("search",e.search),(null==e?void 0:e.status)&&s.append("status",e.status),(null==e?void 0:e.date_from)&&s.append("date_from",e.date_from),(null==e?void 0:e.date_to)&&s.append("date_to",e.date_to),(null==e?void 0:e.shop)&&s.append("shop",e.shop);let t=s.toString()?"".concat(n,"?").concat(s.toString()):n;return(await a.default.get(t)).data}catch(e){throw Error("Failed to fetch invoices.")}},l=async e=>{try{return(await a.default.post(n,e)).data}catch(e){throw Error("Failed to create invoice.")}};var i=t(43114),c=t(39740);let d=async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"30";try{return await (0,c.t)(e)}catch(e){throw Error("Failed to fetch sales statistics.")}},o=async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10;arguments.length>1&&void 0!==arguments[1]&&arguments[1];try{console.log("\uD83D\uDD04 Fetching recent invoices from API");let s=await r({page:"1"});return Array.isArray(null==s?void 0:s.results)&&s.results.length&&(s.results=s.results.slice(0,e)),s}catch(e){throw Error("Failed to fetch recent invoices.")}},m=async function(){arguments.length>0&&void 0!==arguments[0]&&arguments[0];try{console.log("\uD83D\uDD04 Fetching fresh invoices from API");let e=await r({});return Array.isArray(null==e?void 0:e.results)&&e.results.length&&(e.results=e.results.slice(0,e.count)),e}catch(e){throw Error("Failed to fetch all invoices.")}},x=async e=>{try{return await (0,i.ZK)({search:e})}catch(e){throw Error("Failed to fetch products for sale.")}},u=async e=>{try{return await l(e)}catch(e){throw Error("Failed to create sales invoice.")}}},82714:(e,s,t)=>{"use strict";t.d(s,{J:()=>l});var a=t(95155);t(12115);var n=t(40968),r=t(53999);function l(e){let{className:s,...t}=e;return(0,a.jsx)(n.b,{"data-slot":"label",className:(0,r.cn)("flex items-center gap-2 text-sm leading-none font-medium select-none group-data-[disabled=true]:pointer-events-none group-data-[disabled=true]:opacity-50 peer-disabled:cursor-not-allowed peer-disabled:opacity-50",s),...t})}},89852:(e,s,t)=>{"use strict";t.d(s,{p:()=>r});var a=t(95155);t(12115);var n=t(53999);function r(e){let{className:s,type:t,...r}=e;return(0,a.jsx)("input",{type:t,"data-slot":"input",className:(0,n.cn)("file:text-foreground placeholder:text-muted-foreground selection:bg-primary selection:text-primary-foreground dark:bg-input/30 border-input flex h-9 w-full min-w-0 rounded-md border bg-transparent px-3 py-1 text-base shadow-xs transition-[color,box-shadow] outline-none file:inline-flex file:h-7 file:border-0 file:bg-transparent file:text-sm file:font-medium disabled:pointer-events-none disabled:cursor-not-allowed disabled:opacity-50 md:text-sm","focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px]","aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",s),...r})}}},e=>{e.O(0,[6586,4277,8543,6373,4783,8787,6489,7435,9531,1778,3114,5549,8441,5964,7358],()=>e(e.s=15932)),_N_E=e.O()}]);