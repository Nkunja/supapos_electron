(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4214,8729],{5540:(e,s,t)=>{"use strict";t.d(s,{A1:()=>u,AC:()=>m,Hr:()=>g,KM:()=>n,KZ:()=>l,Nx:()=>o,SY:()=>i,aF:()=>c,dG:()=>d,vz:()=>x,wO:()=>h}),t(8102);var a=t(61778);let r="".concat("https://supa.sirnkunja.co.ke/","api/shops/"),n=async()=>{try{return(await a.default.get(r)).data}catch(e){throw Error("Failed to fetch shops.")}},i=async e=>{try{return(await a.default.get("".concat(r).concat(e,"/total_cash_spent/"))).data}catch(e){throw console.error("Failed to fetch shop total cash spent:",e),Error("Failed to fetch shop total cash spent.")}},l=async()=>{try{return(await a.default.get("".concat(r,"active_shops/"))).data}catch(e){throw Error("Failed to fetch active shops.")}},c=async()=>{try{return(await a.default.get("".concat(r,"my_shops/"))).data}catch(e){throw Error("Failed to fetch my shops.")}},o=async e=>{try{return(await a.default.get("".concat(r).concat(e,"/"))).data}catch(e){throw Error("Failed to fetch shop.")}},d=async e=>{try{return(await a.default.post(r,e)).data}catch(e){throw Error("Failed to create shop.")}},u=async(e,s)=>{try{return(await a.default.put("".concat(r).concat(e,"/"),s)).data}catch(e){throw Error("Failed to update shop.")}},m=async e=>{try{return(await a.default.delete("".concat(r).concat(e,"/"))).data}catch(e){throw Error("Failed to delete shop.")}},x=async(e,s)=>{try{return(await a.default.post("".concat(r).concat(e,"/assign_salesperson/"),s)).data}catch(e){throw Error("Failed to assign salesperson.")}},h=async(e,s)=>{try{return(await a.default.post("".concat(r).concat(e,"/remove_salesperson/"),s)).data}catch(e){throw Error("Failed to remove salesperson.")}},g=async e=>{try{return(await a.default.get("".concat(r).concat(e,"/salespersons_list/"))).data}catch(e){throw Error("Failed to fetch shop salespersons.")}}},37049:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>et});var a=t(95155),r=t(12115),n=t(61778);let i="https://supa.sirnkunja.co.ke/",l=async()=>{try{let e=await n.default.get("".concat(i,"/api/customers/"));return Array.isArray(e.data)?e.data:e.data.results||[]}catch(e){throw console.error("API Error - getCustomers:",e),Error("Failed to fetch customers.")}},c=async e=>{try{return(await n.default.post("".concat(i,"/api/customers/"),e)).data}catch(e){var s,t;throw console.error("API Error - createCustomer:",e),Error((null==(t=e.response)||null==(s=t.data)?void 0:s.message)||e.message||"Failed to create customer.")}},o=async(e,s)=>{try{return(await n.default.patch("".concat(i,"/api/customers/").concat(e,"/"),s)).data}catch(s){var t,a;throw console.error("API Error - updateCustomer(".concat(e,"):"),s),Error((null==(a=s.response)||null==(t=a.data)?void 0:t.message)||s.message||"Failed to update customer with ID ".concat(e,"."))}},d=async e=>{try{await n.default.delete("".concat(i,"/api/customers/").concat(e,"/"))}catch(r){var s,t,a;if(console.error("API Error - deleteCustomer(".concat(e,"):"),r),(null==(s=r.response)?void 0:s.status)===403)throw Error("Only admin users can delete customers.");throw Error((null==(a=r.response)||null==(t=a.data)?void 0:t.message)||r.message||"Failed to delete customer with ID ".concat(e,"."))}},u=async()=>{try{return(await n.default.get("".concat(i,"/api/customers/due_visits/"))).data}catch(e){throw console.error("API Error - getDueVisits:",e),Error("Failed to fetch customers due for visits.")}},m=async()=>{try{return(await n.default.get("".concat(i,"/api/customers/upcoming_visits/"))).data}catch(e){throw console.error("API Error - getUpcomingVisits:",e),Error("Failed to fetch customers with upcoming visits.")}},x=async e=>{try{return(await n.default.post("".concat(i,"/api/customers/").concat(e,"/update_visit/"))).data}catch(a){var s,t;throw console.error("API Error - updateCustomerVisit(".concat(e,"):"),a),Error((null==(t=a.response)||null==(s=t.data)?void 0:s.message)||a.message||"Failed to update visit for customer with ID ".concat(e,"."))}},h=async(e,s)=>{try{return(await n.default.post("".concat(i,"/api/customers/").concat(e,"/manage_prescriptions/"),s)).data}catch(s){var t,a;throw console.error("API Error - managePrescriptions(".concat(e,"):"),s),Error((null==(a=s.response)||null==(t=a.data)?void 0:t.message)||s.message||"Failed to manage prescriptions for customer with ID ".concat(e,"."))}};var g=t(97168),p=t(89852),f=t(88524),v=t(88482),j=t(88145),y=t(67133),b=t(38543),N=t(51154),w=t(17580),_=t(84616),A=t(55670),C=t(14186),F=t(47924),k=t(19420),E=t(69074),S=t(5623),R=t(92657),I=t(13717),Z=t(62525),z=t(54312),D=t(5540),L=t(82714),P=t(49026),B=t(95784),q=t(95139),W=t(54416),V=t(1243),J=t(40646),M=t(71007),U=t(28883),$=t(4516),O=t(51976),T=t(20215),G=t(4229),H=t(97502);let K={first_name:"",last_name:"",phone_number:"",email:"",date_of_birth:"",gender:"",address:"",allergies:"",medical_conditions:"",description:"",medication_notes:"",is_active:!0,shop:null,visit_frequency_days:null,notes:"",selectedPrescriptions:[]};function X(e){var s;let{isOpen:t,onClose:n,customer:i,onSuccess:l}=e,{user:d}=(0,H.Z)(),[u,m]=(0,r.useState)(K),[x,f]=(0,r.useState)(!1),[j,y]=(0,r.useState)(""),[_,A]=(0,r.useState)(""),[C,F]=(0,r.useState)([]),[E,S]=(0,r.useState)([]),[R,I]=(0,r.useState)(!1),[Z,X]=(0,r.useState)(!1),[Y,Q]=(0,r.useState)([]);(0,r.useEffect)(()=>{t&&(ee(),es())},[t]),(0,r.useEffect)(()=>{if(i){var e,s,t,a;m({first_name:i.first_name||"",last_name:i.last_name||"",phone_number:i.phone_number||"",email:i.email||"",date_of_birth:i.date_of_birth||"",gender:i.gender||"",address:i.address||"",allergies:i.allergies||"",medical_conditions:i.medical_conditions||"",description:i.description||"",medication_notes:i.medication_notes||"",is_active:null==(a=i.is_active)||a,shop:"number"==typeof i.shop?i.shop:(null==(e=i.shop)?void 0:e.id)||null,visit_frequency_days:i.visit_frequency_days||null,notes:i.notes||"",selectedPrescriptions:(null==(s=i.prescriptions)?void 0:s.map(e=>e.id))||[]}),Q((null==(t=i.prescriptions)?void 0:t.map(e=>e.id))||[])}else m(K),Q([]);y(""),A("")},[i,t]);let ee=async()=>{I(!0);try{let e=await (0,D.KZ)();F(Array.isArray(e)?e:[])}catch(e){b.oR.error("Failed to load shops"),F([])}finally{I(!1)}},es=async()=>{X(!0);try{let e=await (0,z.d$)(),s=Array.isArray(e)?e:(null==e?void 0:e.results)||[];S(s)}catch(e){b.oR.error("Failed to load products"),S([])}finally{X(!1)}},et=(e,s)=>{m(t=>({...t,[e]:s})),j&&y(""),_&&A("")},ea=async e=>{if(e.preventDefault(),u.first_name.trim()?u.last_name.trim()?!!u.phone_number.trim()||(y("Phone number is required"),!1):(y("Last name is required"),!1):(y("First name is required"),!1)){f(!0),y(""),A("");try{let e,s={first_name:u.first_name,last_name:u.last_name,phone_number:u.phone_number,email:u.email||void 0,date_of_birth:u.date_of_birth||void 0,gender:u.gender||void 0,address:u.address||void 0,allergies:u.allergies||void 0,medical_conditions:u.medical_conditions||void 0,description:u.description||void 0,medication_notes:u.medication_notes||void 0,is_active:u.is_active,shop:u.shop||void 0,visit_frequency_days:u.visit_frequency_days||void 0,notes:u.notes||void 0};i?(e=(await o(i.id,s)).id,b.oR.success("Customer updated successfully!"),A("Customer updated successfully!")):(e=(await c(s)).id,b.oR.success("Customer created successfully!"),A("Customer created successfully!"));let t=u.selectedPrescriptions.filter(e=>!Y.includes(e)),a=Y.filter(e=>!u.selectedPrescriptions.includes(e));t.length>0&&await h(e,{action:"add",product_ids:t}),a.length>0&&await h(e,{action:"remove",product_ids:a}),l(),m(K),n()}catch(s){let e=s.message||"An error occurred";y(e),b.oR.error(e)}finally{f(!1)}}},er=(null==d?void 0:d.role)!=="admin"&&!!i;return t?(0,a.jsx)("div",{className:"fixed inset-0 z-50 flex justify-end pointer-events-none",children:(0,a.jsxs)("div",{className:"bg-white w-full max-w-4xl h-full overflow-y-auto shadow-2xl pointer-events-auto",children:[(0,a.jsx)("div",{className:"sticky top-0 bg-white border-b p-6 z-10",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h2",{className:"text-2xl font-bold text-gray-900",children:i?"Edit Customer":"Add New Customer"}),(0,a.jsx)("p",{className:"text-gray-600 mt-1",children:i?"Update customer information and prescriptions":"Create a new customer profile"})]}),(0,a.jsx)(g.$,{variant:"ghost",size:"icon",onClick:n,className:"h-8 w-8",children:(0,a.jsx)(W.A,{className:"h-4 w-4"})})]})}),(0,a.jsxs)("div",{className:"p-6 space-y-6",children:[j&&(0,a.jsxs)(P.Fc,{className:"border-red-200 bg-red-50",children:[(0,a.jsx)(V.A,{className:"h-4 w-4 text-red-600"}),(0,a.jsx)(P.TN,{className:"text-red-800",children:j})]}),_&&(0,a.jsxs)(P.Fc,{className:"border-green-200 bg-green-50",children:[(0,a.jsx)(J.A,{className:"h-4 w-4 text-green-600"}),(0,a.jsx)(P.TN,{className:"text-green-800",children:_})]}),(0,a.jsxs)("form",{onSubmit:ea,className:"space-y-6",children:[(0,a.jsxs)(v.Zp,{className:"border-gray-200 shadow-sm",children:[(0,a.jsxs)(v.aR,{className:"bg-gray-50/50",children:[(0,a.jsxs)(v.ZB,{className:"text-lg font-semibold text-gray-800 flex items-center",children:[(0,a.jsx)(M.A,{className:"mr-2 h-5 w-5"}),"Personal Information"]}),(0,a.jsx)(v.BT,{className:"text-gray-600",children:"Basic customer details"})]}),(0,a.jsx)(v.Wu,{className:"pt-6",children:(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsxs)(L.J,{htmlFor:"first_name",className:"text-sm font-medium text-gray-700",children:["First Name ",(0,a.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,a.jsx)(p.p,{id:"first_name",value:u.first_name,onChange:e=>et("first_name",e.target.value),placeholder:"Enter first name",className:"border-gray-300 focus:border-blue-500 focus:ring-blue-500",required:!0})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsxs)(L.J,{htmlFor:"last_name",className:"text-sm font-medium text-gray-700",children:["Last Name ",(0,a.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,a.jsx)(p.p,{id:"last_name",value:u.last_name,onChange:e=>et("last_name",e.target.value),placeholder:"Enter last name",className:"border-gray-300 focus:border-blue-500 focus:ring-blue-500",required:!0})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(L.J,{htmlFor:"date_of_birth",className:"text-sm font-medium text-gray-700",children:"Date of Birth"}),(0,a.jsx)(p.p,{id:"date_of_birth",type:"date",value:u.date_of_birth,onChange:e=>et("date_of_birth",e.target.value),className:"border-gray-300 focus:border-blue-500 focus:ring-blue-500"})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(L.J,{htmlFor:"gender",className:"text-sm font-medium text-gray-700",children:"Gender"}),(0,a.jsxs)(B.l6,{value:u.gender,onValueChange:e=>et("gender",e),children:[(0,a.jsx)(B.bq,{className:"border-gray-300 focus:border-blue-500 focus:ring-blue-500",children:(0,a.jsx)(B.yv,{placeholder:"Select gender"})}),(0,a.jsxs)(B.gC,{children:[(0,a.jsx)(B.eb,{value:"M",children:"Male"}),(0,a.jsx)(B.eb,{value:"F",children:"Female"}),(0,a.jsx)(B.eb,{value:"O",children:"Other"})]})]})]})]})})]}),(0,a.jsxs)(v.Zp,{className:"border-gray-200 shadow-sm",children:[(0,a.jsx)(v.aR,{className:"bg-gray-50/50",children:(0,a.jsxs)(v.ZB,{className:"text-lg font-semibold text-gray-800 flex items-center",children:[(0,a.jsx)(k.A,{className:"mr-2 h-5 w-5"}),"Contact Information"]})}),(0,a.jsx)(v.Wu,{className:"pt-6",children:(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsxs)(L.J,{htmlFor:"phone_number",className:"text-sm font-medium text-gray-700",children:["Phone Number ",(0,a.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,a.jsx)(p.p,{id:"phone_number",value:u.phone_number,onChange:e=>et("phone_number",e.target.value),placeholder:"Enter phone number",className:"border-gray-300 focus:border-blue-500 focus:ring-blue-500",required:!0})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(L.J,{htmlFor:"email",className:"text-sm font-medium text-gray-700",children:"Email Address"}),(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)(U.A,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 h-4 w-4"}),(0,a.jsx)(p.p,{id:"email",type:"email",value:u.email,onChange:e=>et("email",e.target.value),placeholder:"Enter email address",className:"pl-10 border-gray-300 focus:border-blue-500 focus:ring-blue-500"})]})]}),(0,a.jsxs)("div",{className:"space-y-2 col-span-2",children:[(0,a.jsx)(L.J,{htmlFor:"address",className:"text-sm font-medium text-gray-700",children:"Address"}),(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)($.A,{className:"absolute left-3 top-3 text-gray-400 h-4 w-4"}),(0,a.jsx)("textarea",{id:"address",value:u.address,onChange:e=>et("address",e.target.value),placeholder:"Enter address",className:"w-full pl-10 px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500",rows:3})]})]})]})})]}),(0,a.jsxs)(v.Zp,{className:"border-gray-200 shadow-sm",children:[(0,a.jsx)(v.aR,{className:"bg-gray-50/50",children:(0,a.jsxs)(v.ZB,{className:"text-lg font-semibold text-gray-800 flex items-center",children:[(0,a.jsx)(O.A,{className:"mr-2 h-5 w-5"}),"Medical Information"]})}),(0,a.jsx)(v.Wu,{className:"pt-6",children:(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(L.J,{htmlFor:"allergies",className:"text-sm font-medium text-gray-700",children:"Allergies"}),(0,a.jsx)("textarea",{id:"allergies",value:u.allergies,onChange:e=>et("allergies",e.target.value),placeholder:"List any known allergies",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500",rows:2})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(L.J,{htmlFor:"medical_conditions",className:"text-sm font-medium text-gray-700",children:"Medical Conditions"}),(0,a.jsx)("textarea",{id:"medical_conditions",value:u.medical_conditions,onChange:e=>et("medical_conditions",e.target.value),placeholder:"List any medical conditions",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500",rows:2})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(L.J,{htmlFor:"medication_notes",className:"text-sm font-medium text-gray-700",children:"Medication Notes"}),(0,a.jsx)("textarea",{id:"medication_notes",value:u.medication_notes,onChange:e=>et("medication_notes",e.target.value),placeholder:"Notes about medications, dosages, instructions",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500",rows:3})]})]})})]}),(0,a.jsxs)(v.Zp,{className:"border-gray-200 shadow-sm",children:[(0,a.jsxs)(v.aR,{className:"bg-gray-50/50",children:[(0,a.jsxs)(v.ZB,{className:"text-lg font-semibold text-gray-800 flex items-center",children:[(0,a.jsx)(T.A,{className:"mr-2 h-5 w-5"}),"Prescriptions"]}),(0,a.jsx)(v.BT,{className:"text-gray-600",children:"Select current medications"})]}),(0,a.jsx)(v.Wu,{className:"pt-6",children:Z?(0,a.jsxs)("div",{className:"flex items-center justify-center py-4",children:[(0,a.jsx)(N.A,{className:"h-6 w-6 animate-spin mr-2"}),"Loading products..."]}):0===E.length?(0,a.jsxs)("div",{className:"text-center py-4",children:[(0,a.jsx)(T.A,{className:"h-8 w-8 text-gray-400 mx-auto mb-2"}),(0,a.jsx)("p",{className:"text-gray-500",children:"No products available"})]}):(0,a.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 max-h-60 overflow-y-auto",children:E.map(e=>(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)(q.S,{id:"product-".concat(e.id),checked:u.selectedPrescriptions.includes(e.id),onCheckedChange:s=>{var t;return t=e.id,void m(e=>({...e,selectedPrescriptions:s?[...e.selectedPrescriptions,t]:e.selectedPrescriptions.filter(e=>e!==t)}))}}),(0,a.jsxs)(L.J,{htmlFor:"product-".concat(e.id),className:"text-sm text-gray-700 cursor-pointer",children:[e.name,e.generic_name&&(0,a.jsxs)("span",{className:"text-gray-500",children:[" (",e.generic_name,")"]})]})]},e.id))})})]}),(0,a.jsxs)(v.Zp,{className:"border-gray-200 shadow-sm",children:[(0,a.jsx)(v.aR,{className:"bg-gray-50/50",children:(0,a.jsxs)(v.ZB,{className:"text-lg font-semibold text-gray-800 flex items-center",children:[(0,a.jsx)(w.A,{className:"mr-2 h-5 w-5"}),"Business Information"]})}),(0,a.jsx)(v.Wu,{className:"pt-6",children:(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(L.J,{htmlFor:"shop",className:"text-sm font-medium text-gray-700",children:"Shop"}),(0,a.jsxs)(B.l6,{value:(null==(s=u.shop)?void 0:s.toString())||"none",onValueChange:e=>{"none"===e?et("shop",null):et("shop",parseInt(e))},disabled:er,children:[(0,a.jsx)(B.bq,{className:"border-gray-300 focus:border-blue-500 focus:ring-blue-500",children:(0,a.jsx)(B.yv,{placeholder:"Select a shop"})}),(0,a.jsxs)(B.gC,{children:[(0,a.jsx)(B.eb,{value:"none",children:"No shop selected"}),R?(0,a.jsxs)(B.eb,{value:"loading",disabled:!0,children:[(0,a.jsx)(N.A,{className:"h-4 w-4 animate-spin mr-2"}),"Loading shops..."]}):C.map(e=>(0,a.jsx)(B.eb,{value:e.id.toString(),children:e.name},e.id))]})]}),er&&(0,a.jsx)("p",{className:"text-xs text-gray-500",children:"Shop can only be changed by administrators"})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(L.J,{htmlFor:"visit_frequency_days",className:"text-sm font-medium text-gray-700",children:"Visit Frequency (Days)"}),(0,a.jsx)(p.p,{id:"visit_frequency_days",type:"number",min:"1",value:u.visit_frequency_days||"",onChange:e=>et("visit_frequency_days",e.target.value?parseInt(e.target.value):null),placeholder:"e.g., 30 for monthly visits",className:"border-gray-300 focus:border-blue-500 focus:ring-blue-500"})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)(q.S,{id:"is_active",checked:u.is_active,onCheckedChange:e=>et("is_active",e)}),(0,a.jsx)(L.J,{htmlFor:"is_active",className:"text-sm font-medium text-gray-700",children:"Active Customer"})]})]})})]}),(0,a.jsxs)(v.Zp,{className:"border-gray-200 shadow-sm",children:[(0,a.jsx)(v.aR,{className:"bg-gray-50/50",children:(0,a.jsx)(v.ZB,{className:"text-lg font-semibold text-gray-800",children:"Additional Information"})}),(0,a.jsx)(v.Wu,{className:"pt-6",children:(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(L.J,{htmlFor:"description",className:"text-sm font-medium text-gray-700",children:"Description"}),(0,a.jsx)("textarea",{id:"description",value:u.description,onChange:e=>et("description",e.target.value),placeholder:"General description or notes about the customer",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500",rows:2})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(L.J,{htmlFor:"notes",className:"text-sm font-medium text-gray-700",children:"Notes"}),(0,a.jsx)("textarea",{id:"notes",value:u.notes,onChange:e=>et("notes",e.target.value),placeholder:"Additional notes",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500",rows:3})]})]})})]}),(0,a.jsxs)("div",{className:"flex justify-end space-x-4 pt-6 border-t border-gray-200",children:[(0,a.jsx)(g.$,{type:"button",variant:"outline",onClick:n,disabled:x,className:"min-w-[100px]",children:"Cancel"}),(0,a.jsx)(g.$,{type:"submit",disabled:x,className:"min-w-[120px] bg-blue-600 hover:bg-blue-700",children:x?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(N.A,{className:"mr-2 h-4 w-4 animate-spin"}),"Saving..."]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(G.A,{className:"mr-2 h-4 w-4"}),i?"Update Customer":"Create Customer"]})})]})]})]})]})}):null}var Y=t(85339),Q=t(57434);let ee=e=>{let{icon:s,label:t,value:r,fallback:n="Not provided"}=e;return(0,a.jsxs)("div",{className:"flex items-start space-x-3 py-2",children:[(0,a.jsx)("div",{className:"flex-shrink-0 mt-0.5",children:s}),(0,a.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,a.jsx)("p",{className:"text-sm font-medium text-gray-700",children:t}),(0,a.jsx)("p",{className:"text-sm text-gray-900 break-words",children:r||(0,a.jsx)("span",{className:"text-gray-400 italic",children:n})})]})]})};function es(e){var s;let{isOpen:t,onClose:n,customer:i}=e,[l,c]=(0,r.useState)([]),[o,d]=(0,r.useState)([]),[u,m]=(0,r.useState)(!0),[x,h]=(0,r.useState)(null);(0,r.useEffect)(()=>{t&&i&&p()},[t,i]);let p=async()=>{m(!0),h(null);try{let[e,s]=await Promise.all([(0,z.d$)(),(0,D.KZ)()]),t=Array.isArray(e)?e:(null==e?void 0:e.results)||[];c(t),d(Array.isArray(s)?s:[])}catch(e){console.error("Error loading data:",e),h("Failed to load additional information")}finally{m(!1)}},f=e=>{if(!e)return null;try{return new Date(e).toLocaleString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})}catch(s){return e}};if(!t||!i)return null;let y=(null==i?void 0:i.prescriptions)&&0!==i.prescriptions.length?i.prescriptions.map(e=>{let s="number"==typeof e?e:parseInt(e.toString()),t=l.find(e=>e.id===s);return t?{id:s,name:t.name,genericName:t.generic_name}:{id:s,name:"Product ID: ".concat(s),genericName:null}}).filter(Boolean):[],b=(e=>{if(!e)return null;try{let s=new Date(e),t=new Date,a=t.getFullYear()-s.getFullYear(),r=t.getMonth()-s.getMonth();return(r<0||0===r&&t.getDate()<s.getDate())&&a--,a}catch(e){return null}})(i.date_of_birth),_=null!=(s=i.shop_name)?s:null,A=(e=>{if(!e)return!1;try{return new Date(e)<new Date}catch(e){return!1}})(i.next_visit);return(0,a.jsx)("div",{className:"fixed inset-0 z-50 flex justify-end pointer-events-none",children:(0,a.jsxs)("div",{className:"bg-white w-full max-w-4xl h-full overflow-y-auto shadow-2xl pointer-events-auto",children:[(0,a.jsx)("div",{className:"sticky top-0 bg-white border-b p-6 z-10",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h2",{className:"text-2xl font-bold text-gray-900",children:"Customer Details"}),(0,a.jsx)("p",{className:"text-gray-600 mt-1",children:i.full_name||"".concat(i.first_name," ").concat(i.last_name)})]}),(0,a.jsx)(g.$,{variant:"ghost",size:"icon",onClick:n,className:"h-8 w-8",children:(0,a.jsx)(W.A,{className:"h-4 w-4"})})]})}),(0,a.jsxs)("div",{className:"p-6 space-y-6",children:[u&&(0,a.jsxs)("div",{className:"flex items-center justify-center py-4",children:[(0,a.jsx)(N.A,{className:"h-6 w-6 animate-spin mr-2"}),(0,a.jsx)("span",{children:"Loading additional information..."})]}),x&&(0,a.jsxs)("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4 flex items-start space-x-2",children:[(0,a.jsx)(Y.A,{className:"h-5 w-5 text-yellow-600 flex-shrink-0 mt-0.5"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-yellow-800 font-medium",children:"Warning"}),(0,a.jsx)("p",{className:"text-yellow-700 text-sm",children:x})]})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,a.jsx)(j.E,{className:i.is_active?"bg-green-100 text-green-800":"bg-red-100 text-red-800",children:i.is_active?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(J.A,{className:"h-3 w-3 mr-1"}),"Active Customer"]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(Y.A,{className:"h-3 w-3 mr-1"}),"Inactive Customer"]})}),A&&(0,a.jsxs)(j.E,{className:"bg-red-100 text-red-800",children:[(0,a.jsx)(C.A,{className:"h-3 w-3 mr-1"}),"Visit Overdue"]})]}),(0,a.jsxs)(v.Zp,{className:"border-gray-200 shadow-sm",children:[(0,a.jsx)(v.aR,{className:"bg-gray-50/50",children:(0,a.jsxs)(v.ZB,{className:"text-lg font-semibold text-gray-800 flex items-center",children:[(0,a.jsx)(M.A,{className:"mr-2 h-5 w-5"}),"Personal Information"]})}),(0,a.jsx)(v.Wu,{className:"pt-6",children:(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,a.jsx)(ee,{icon:(0,a.jsx)(M.A,{className:"h-4 w-4 text-gray-500"}),label:"Full Name",value:i.full_name||"".concat(i.first_name," ").concat(i.last_name)}),(0,a.jsx)(ee,{icon:(0,a.jsx)(E.A,{className:"h-4 w-4 text-gray-500"}),label:"Date of Birth",value:(e=>{if(!e)return null;try{return new Date(e).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"})}catch(s){return e}})(i.date_of_birth)}),(0,a.jsx)(ee,{icon:(0,a.jsx)(M.A,{className:"h-4 w-4 text-gray-500"}),label:"Gender",value:(e=>{switch(e){case"M":return"Male";case"F":return"Female";case"O":return"Other";default:return null}})(i.gender)}),(0,a.jsx)(ee,{icon:(0,a.jsx)(E.A,{className:"h-4 w-4 text-gray-500"}),label:"Age",value:b?"".concat(b," years old"):null})]})})]}),(0,a.jsxs)(v.Zp,{className:"border-gray-200 shadow-sm",children:[(0,a.jsx)(v.aR,{className:"bg-gray-50/50",children:(0,a.jsxs)(v.ZB,{className:"text-lg font-semibold text-gray-800 flex items-center",children:[(0,a.jsx)(k.A,{className:"mr-2 h-5 w-5"}),"Contact Information"]})}),(0,a.jsx)(v.Wu,{className:"pt-6",children:(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsx)(ee,{icon:(0,a.jsx)(k.A,{className:"h-4 w-4 text-gray-500"}),label:"Phone Number",value:i.phone_number}),(0,a.jsx)(ee,{icon:(0,a.jsx)(U.A,{className:"h-4 w-4 text-gray-500"}),label:"Email Address",value:i.email}),(0,a.jsx)(ee,{icon:(0,a.jsx)($.A,{className:"h-4 w-4 text-gray-500"}),label:"Address",value:i.address})]})})]}),(0,a.jsxs)(v.Zp,{className:"border-gray-200 shadow-sm",children:[(0,a.jsx)(v.aR,{className:"bg-gray-50/50",children:(0,a.jsxs)(v.ZB,{className:"text-lg font-semibold text-gray-800 flex items-center",children:[(0,a.jsx)(O.A,{className:"mr-2 h-5 w-5"}),"Medical Information"]})}),(0,a.jsx)(v.Wu,{className:"pt-6",children:(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsx)(ee,{icon:(0,a.jsx)(Y.A,{className:"h-4 w-4 text-gray-500"}),label:"Allergies",value:i.allergies}),(0,a.jsx)(ee,{icon:(0,a.jsx)(O.A,{className:"h-4 w-4 text-gray-500"}),label:"Medical Conditions",value:i.medical_conditions}),(0,a.jsx)(ee,{icon:(0,a.jsx)(Q.A,{className:"h-4 w-4 text-gray-500"}),label:"Medication Notes",value:i.medication_notes})]})})]}),(0,a.jsxs)(v.Zp,{className:"border-gray-200 shadow-sm",children:[(0,a.jsx)(v.aR,{className:"bg-gray-50/50",children:(0,a.jsxs)(v.ZB,{className:"text-lg font-semibold text-gray-800 flex items-center",children:[(0,a.jsx)(T.A,{className:"mr-2 h-5 w-5"}),"Current Prescriptions (",y.length,")"]})}),(0,a.jsx)(v.Wu,{className:"pt-6",children:u?(0,a.jsxs)("div",{className:"flex items-center justify-center py-4",children:[(0,a.jsx)(N.A,{className:"h-4 w-4 animate-spin mr-2"}),"Loading prescriptions..."]}):0===y.length?(0,a.jsxs)("div",{className:"text-center py-8",children:[(0,a.jsx)(T.A,{className:"h-8 w-8 text-gray-400 mx-auto mb-2"}),(0,a.jsx)("p",{className:"text-gray-500",children:"No prescriptions on file"})]}):(0,a.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:y.map(e=>(0,a.jsx)("div",{className:"p-4 border border-gray-200 rounded-lg bg-gray-50",children:(0,a.jsxs)("div",{className:"flex items-start space-x-2",children:[(0,a.jsx)(T.A,{className:"h-4 w-4 text-blue-500 flex-shrink-0 mt-0.5"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"font-medium text-gray-900",children:e.name}),e.genericName&&e.genericName!==e.name&&(0,a.jsxs)("p",{className:"text-sm text-gray-600",children:["Generic: ",e.genericName]})]})]})},e.id.toString()))})})]}),(0,a.jsxs)(v.Zp,{className:"border-gray-200 shadow-sm",children:[(0,a.jsx)(v.aR,{className:"bg-gray-50/50",children:(0,a.jsxs)(v.ZB,{className:"text-lg font-semibold text-gray-800 flex items-center",children:[(0,a.jsx)(E.A,{className:"mr-2 h-5 w-5"}),"Visit Information"]})}),(0,a.jsx)(v.Wu,{className:"pt-6",children:(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,a.jsx)(ee,{icon:(0,a.jsx)(E.A,{className:"h-4 w-4 text-gray-500"}),label:"Last Visit",value:f(i.last_visit)}),(0,a.jsx)(ee,{icon:(0,a.jsx)(E.A,{className:"h-4 w-4 text-gray-500"}),label:"Next Visit",value:f(i.next_visit)}),(0,a.jsx)(ee,{icon:(0,a.jsx)(C.A,{className:"h-4 w-4 text-gray-500"}),label:"Visit Frequency",value:i.visit_frequency_days?"Every ".concat(i.visit_frequency_days," days"):null})]})})]}),(0,a.jsxs)(v.Zp,{className:"border-gray-200 shadow-sm",children:[(0,a.jsx)(v.aR,{className:"bg-gray-50/50",children:(0,a.jsxs)(v.ZB,{className:"text-lg font-semibold text-gray-800 flex items-center",children:[(0,a.jsx)(w.A,{className:"mr-2 h-5 w-5"}),"Business Information"]})}),(0,a.jsx)(v.Wu,{className:"pt-6",children:(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsx)(ee,{icon:(0,a.jsx)(w.A,{className:"h-4 w-4 text-gray-500"}),label:"Shop",value:u?"Loading...":_}),(0,a.jsx)(ee,{icon:(0,a.jsx)(E.A,{className:"h-4 w-4 text-gray-500"}),label:"Customer Since",value:f(i.created_at)}),(0,a.jsx)(ee,{icon:(0,a.jsx)(E.A,{className:"h-4 w-4 text-gray-500"}),label:"Last Updated",value:f(i.updated_at)})]})})]}),(0,a.jsxs)(v.Zp,{className:"border-gray-200 shadow-sm",children:[(0,a.jsx)(v.aR,{className:"bg-gray-50/50",children:(0,a.jsxs)(v.ZB,{className:"text-lg font-semibold text-gray-800 flex items-center",children:[(0,a.jsx)(Q.A,{className:"mr-2 h-5 w-5"}),"Notes & Additional Information"]})}),(0,a.jsx)(v.Wu,{className:"pt-6",children:(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsx)(ee,{icon:(0,a.jsx)(Q.A,{className:"h-4 w-4 text-gray-500"}),label:"Description",value:i.description}),(0,a.jsx)(ee,{icon:(0,a.jsx)(Q.A,{className:"h-4 w-4 text-gray-500"}),label:"Notes",value:i.notes})]})})]})]})]})})}function et(){let[e,s]=(0,r.useState)([]),[t,n]=(0,r.useState)(!0),[i,c]=(0,r.useState)(null),[o,h]=(0,r.useState)(""),[z,D]=(0,r.useState)(!1),[L,P]=(0,r.useState)(!1),[B,q]=(0,r.useState)(null),[W,V]=(0,r.useState)(null),[J,M]=(0,r.useState)(null),[U,$]=(0,r.useState)("all"),[O,T]=(0,r.useState)(0),[G,H]=(0,r.useState)(0);(0,r.useEffect)(()=>{K(),Y()},[]);let K=async()=>{n(!0),c(null);try{let e=await l();Array.isArray(e)?s(e):(console.error("API returned unexpected data format:",e),s([]),c("Received unexpected data format from server"),b.oR.error("Failed to load customers: Invalid data format"))}catch(e){console.error("Error loading customers:",e),s([]),c(e.message||"Failed to load customers"),b.oR.error(e.message||"Failed to load customers")}finally{n(!1)}},Y=async()=>{try{let[e,s]=await Promise.all([u(),m()]);T((null==e?void 0:e.count)||0),H((null==s?void 0:s.count)||0)}catch(e){console.error("Error loading visit counts:",e),T(0),H(0)}},Q=()=>{q(null),D(!0)},ee=async e=>{if(!e.id)return void b.oR.error("Invalid customer ID");try{await x(e.id),b.oR.success("Visit updated for ".concat(e.full_name||"".concat(e.first_name," ").concat(e.last_name))),K(),Y()}catch(e){b.oR.error(e.message||"Failed to update visit")}},et=async e=>{if(confirm("Are you sure you want to delete this customer?")){M(e);try{await d(e),b.oR.success("Customer deleted successfully"),K(),Y()}catch(e){b.oR.error(e.message||"Failed to delete customer")}finally{M(null)}}},ea=e=>{if(!e)return"-";try{return new Date(e).toLocaleDateString()}catch(s){return e}},er=e=>{if(!e)return!1;try{return new Date(e)<=new Date}catch(e){return!1}},en=Array.isArray(e)?e.filter(e=>{var s,t,a,r,n;if(!e)return!1;let i=(null==(s=e.first_name)?void 0:s.toLowerCase().includes(o.toLowerCase()))||(null==(t=e.last_name)?void 0:t.toLowerCase().includes(o.toLowerCase()))||(null==(a=e.phone_number)?void 0:a.includes(o))||(null==(r=e.email)?void 0:r.toLowerCase().includes(o.toLowerCase()))||(null==(n=e.full_name)?void 0:n.toLowerCase().includes(o.toLowerCase())),l="all"===U||"active"===U&&e.is_active||"inactive"===U&&!e.is_active;return i&&l}):[];return t?(0,a.jsxs)("div",{className:"flex items-center justify-center h-64",children:[(0,a.jsx)(N.A,{className:"h-8 w-8 animate-spin"}),(0,a.jsx)("span",{className:"ml-2",children:"Loading customers..."})]}):i?(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsx)("div",{className:"flex items-center justify-between",children:(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)(w.A,{className:"h-8 w-8 text-blue-600"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h1",{className:"text-3xl font-bold text-gray-900",children:"Customers"}),(0,a.jsx)("p",{className:"text-gray-600",children:"Manage your customers"})]})]})}),(0,a.jsx)(v.Zp,{children:(0,a.jsx)(v.Wu,{className:"pt-6",children:(0,a.jsxs)("div",{className:"text-center py-8",children:[(0,a.jsx)(w.A,{className:"h-12 w-12 text-red-400 mx-auto mb-4"}),(0,a.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Error Loading Customers"}),(0,a.jsx)("p",{className:"text-gray-600 mb-4",children:i}),(0,a.jsxs)(g.$,{onClick:K,variant:"outline",children:[(0,a.jsx)(N.A,{className:"mr-2 h-4 w-4"}),"Retry"]})]})})})]}):(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)(w.A,{className:"h-8 w-8 text-blue-600"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h1",{className:"text-3xl font-bold text-gray-900",children:"Customers"}),(0,a.jsx)("p",{className:"text-gray-600",children:"Manage your customers and track visits"})]})]}),(0,a.jsxs)(g.$,{onClick:Q,className:"bg-blue-600 hover:bg-blue-700",children:[(0,a.jsx)(_.A,{className:"mr-2 h-4 w-4"}),"Add Customer"]})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[(0,a.jsx)(v.Zp,{children:(0,a.jsx)(v.Wu,{className:"pt-6",children:(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)("div",{className:"p-2 bg-red-100 rounded-lg",children:(0,a.jsx)(A.A,{className:"h-6 w-6 text-red-600"})}),(0,a.jsxs)("div",{className:"ml-4",children:[(0,a.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"Due for Visit"}),(0,a.jsx)("p",{className:"text-2xl font-bold text-gray-900",children:O})]})]})})}),(0,a.jsx)(v.Zp,{children:(0,a.jsx)(v.Wu,{className:"pt-6",children:(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)("div",{className:"p-2 bg-yellow-100 rounded-lg",children:(0,a.jsx)(C.A,{className:"h-6 w-6 text-yellow-600"})}),(0,a.jsxs)("div",{className:"ml-4",children:[(0,a.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"Upcoming Visits"}),(0,a.jsx)("p",{className:"text-2xl font-bold text-gray-900",children:G})]})]})})}),(0,a.jsx)(v.Zp,{children:(0,a.jsx)(v.Wu,{className:"pt-6",children:(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)("div",{className:"p-2 bg-blue-100 rounded-lg",children:(0,a.jsx)(w.A,{className:"h-6 w-6 text-blue-600"})}),(0,a.jsxs)("div",{className:"ml-4",children:[(0,a.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"Total Customers"}),(0,a.jsx)("p",{className:"text-2xl font-bold text-gray-900",children:en.length})]})]})})})]}),(0,a.jsxs)(v.Zp,{children:[(0,a.jsx)(v.aR,{children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)(v.ZB,{children:["Customers (",en.length,")"]}),(0,a.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,a.jsxs)("div",{className:"flex space-x-2",children:[(0,a.jsx)(g.$,{variant:"all"===U?"default":"outline",size:"sm",onClick:()=>$("all"),children:"All"}),(0,a.jsx)(g.$,{variant:"active"===U?"default":"outline",size:"sm",onClick:()=>$("active"),children:"Active"}),(0,a.jsx)(g.$,{variant:"inactive"===U?"default":"outline",size:"sm",onClick:()=>$("inactive"),children:"Inactive"})]}),(0,a.jsxs)("div",{className:"relative w-72",children:[(0,a.jsx)(F.A,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 h-4 w-4"}),(0,a.jsx)(p.p,{placeholder:"Search customers...",value:o,onChange:e=>h(e.target.value),className:"pl-10"})]})]})]})}),(0,a.jsx)(v.Wu,{children:0===en.length?(0,a.jsxs)("div",{className:"text-center py-8",children:[(0,a.jsx)(w.A,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),(0,a.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No customers found"}),(0,a.jsx)("p",{className:"text-gray-600 mb-4",children:o?"Try adjusting your search criteria.":"Get started by adding your first customer."}),!o&&(0,a.jsxs)(g.$,{onClick:Q,children:[(0,a.jsx)(_.A,{className:"mr-2 h-4 w-4"}),"Add Customer"]})]}):(0,a.jsxs)(f.XI,{children:[(0,a.jsx)(f.A0,{children:(0,a.jsxs)(f.Hj,{children:[(0,a.jsx)(f.nd,{children:"Name"}),(0,a.jsx)(f.nd,{children:"Phone"}),(0,a.jsx)(f.nd,{children:"Status"}),(0,a.jsx)(f.nd,{children:"Last Visit"}),(0,a.jsx)(f.nd,{children:"Next Visit"}),(0,a.jsx)(f.nd,{children:"Notes"}),(0,a.jsx)(f.nd,{className:"w-[50px]"})]})}),(0,a.jsx)(f.BF,{children:en.map(e=>(0,a.jsxs)(f.Hj,{children:[(0,a.jsx)(f.nA,{className:"font-medium",children:(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"font-semibold",children:e.full_name||"".concat(e.first_name," ").concat(e.last_name)}),e.email&&(0,a.jsx)("div",{className:"text-sm text-gray-500",children:e.email})]})}),(0,a.jsx)(f.nA,{children:(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)(k.A,{className:"h-4 w-4 mr-2 text-gray-400"}),e.phone_number||"-"]})}),(0,a.jsx)(f.nA,{children:(0,a.jsx)(j.E,{className:e.is_active?"bg-green-100 text-green-800":"bg-red-100 text-red-800",children:e.is_active?"Active":"Inactive"})}),(0,a.jsx)(f.nA,{children:ea(e.last_visit)}),(0,a.jsx)(f.nA,{children:(0,a.jsx)("div",{className:"flex items-center",children:e.next_visit?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(E.A,{className:"h-4 w-4 mr-2 text-gray-400"}),(0,a.jsx)("span",{className:er(e.next_visit)?"text-red-600 font-medium":"",children:ea(e.next_visit)}),er(e.next_visit)&&(0,a.jsx)(j.E,{className:"ml-2 bg-red-100 text-red-800 text-xs",children:"Due"})]}):"-"})}),(0,a.jsx)(f.nA,{children:(0,a.jsx)("div",{className:"max-w-[150px] truncate",title:e.notes||"",children:e.notes||"N/A"})}),(0,a.jsx)(f.nA,{children:(0,a.jsxs)(y.rI,{children:[(0,a.jsx)(y.ty,{asChild:!0,children:(0,a.jsx)(g.$,{variant:"ghost",size:"sm",children:(0,a.jsx)(S.A,{className:"h-4 w-4"})})}),(0,a.jsxs)(y.SQ,{align:"end",children:[(0,a.jsxs)(y._2,{onClick:()=>{V(e),P(!0)},children:[(0,a.jsx)(R.A,{className:"mr-2 h-4 w-4"}),"View Details"]}),(0,a.jsxs)(y._2,{onClick:()=>{q(e),D(!0)},children:[(0,a.jsx)(I.A,{className:"mr-2 h-4 w-4"}),"Edit"]}),(0,a.jsxs)(y._2,{onClick:()=>ee(e),children:[(0,a.jsx)(E.A,{className:"mr-2 h-4 w-4"}),"Update Visit"]}),(0,a.jsxs)(y._2,{onClick:()=>e.id&&et(e.id),className:"text-red-600",disabled:J===e.id,children:[J===e.id?(0,a.jsx)(N.A,{className:"mr-2 h-4 w-4 animate-spin"}):(0,a.jsx)(Z.A,{className:"mr-2 h-4 w-4"}),"Delete"]})]})]})})]},e.id||"customer-".concat(Math.random())))})]})})]}),(0,a.jsx)(X,{isOpen:z,onClose:()=>D(!1),customer:B,onSuccess:()=>{K(),Y(),D(!1),q(null)}}),(0,a.jsx)(es,{isOpen:L,onClose:()=>P(!1),customer:W})]})}},49026:(e,s,t)=>{"use strict";t.d(s,{Fc:()=>l,TN:()=>c});var a=t(95155);t(12115);var r=t(74466),n=t(53999);let i=(0,r.F)("relative w-full rounded-lg border px-4 py-3 text-sm grid has-[>svg]:grid-cols-[calc(var(--spacing)*4)_1fr] grid-cols-[0_1fr] has-[>svg]:gap-x-3 gap-y-0.5 items-start [&>svg]:size-4 [&>svg]:translate-y-0.5 [&>svg]:text-current",{variants:{variant:{default:"bg-card text-card-foreground",destructive:"text-destructive bg-card [&>svg]:text-current *:data-[slot=alert-description]:text-destructive/90"}},defaultVariants:{variant:"default"}});function l(e){let{className:s,variant:t,...r}=e;return(0,a.jsx)("div",{"data-slot":"alert",role:"alert",className:(0,n.cn)(i({variant:t}),s),...r})}function c(e){let{className:s,...t}=e;return(0,a.jsx)("div",{"data-slot":"alert-description",className:(0,n.cn)("text-muted-foreground col-start-2 grid justify-items-start gap-1 text-sm [&_p]:leading-relaxed",s),...t})}},53999:(e,s,t)=>{"use strict";t.d(s,{cn:()=>n});var a=t(52596),r=t(39688);function n(){for(var e=arguments.length,s=Array(e),t=0;t<e;t++)s[t]=arguments[t];return(0,r.QP)((0,a.$)(s))}},54312:(e,s,t)=>{"use strict";t.d(s,{DD:()=>c,WY:()=>i,d$:()=>n,vc:()=>l}),t(8102);var a=t(61778);let r="".concat("https://supa.sirnkunja.co.ke/","api/products/"),n=async e=>{try{let s=new URLSearchParams;(null==e?void 0:e.page)&&s.append("page",e.page),(null==e?void 0:e.search)&&s.append("search",e.search),(null==e?void 0:e.category)&&s.append("category",e.category),(null==e?void 0:e.is_active)&&s.append("is_active",e.is_active);let t=s.toString()?"".concat(r,"?").concat(s.toString()):r;return(await a.default.get(t)).data}catch(e){throw Error("Failed to fetch products.")}},i=async e=>{try{return(await a.default.post(r,e)).data}catch(e){throw Error("Failed to create product.")}},l=async(e,s)=>{try{return(await a.default.put("".concat(r).concat(e,"/"),s)).data}catch(e){throw Error("Failed to update product.")}},c=async e=>{try{return(await a.default.delete("".concat(r).concat(e,"/"))).data}catch(e){throw Error("Failed to delete product.")}}},67133:(e,s,t)=>{"use strict";t.d(s,{SQ:()=>c,_2:()=>o,lp:()=>d,mB:()=>u,rI:()=>i,ty:()=>l});var a=t(95155);t(12115);var r=t(48698),n=t(53999);function i(e){let{...s}=e;return(0,a.jsx)(r.bL,{"data-slot":"dropdown-menu",...s})}function l(e){let{...s}=e;return(0,a.jsx)(r.l9,{"data-slot":"dropdown-menu-trigger",...s})}function c(e){let{className:s,sideOffset:t=4,...i}=e;return(0,a.jsx)(r.ZL,{children:(0,a.jsx)(r.UC,{"data-slot":"dropdown-menu-content",sideOffset:t,className:(0,n.cn)("bg-popover text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 z-50 max-h-(--radix-dropdown-menu-content-available-height) min-w-[8rem] origin-(--radix-dropdown-menu-content-transform-origin) overflow-x-hidden overflow-y-auto rounded-md border p-1 shadow-md",s),...i})})}function o(e){let{className:s,inset:t,variant:i="default",...l}=e;return(0,a.jsx)(r.q7,{"data-slot":"dropdown-menu-item","data-inset":t,"data-variant":i,className:(0,n.cn)("focus:bg-accent focus:text-accent-foreground data-[variant=destructive]:text-destructive data-[variant=destructive]:focus:bg-destructive/10 dark:data-[variant=destructive]:focus:bg-destructive/20 data-[variant=destructive]:focus:text-destructive data-[variant=destructive]:*:[svg]:!text-destructive [&_svg:not([class*='text-'])]:text-muted-foreground relative flex cursor-default items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-hidden select-none data-[disabled]:pointer-events-none data-[disabled]:opacity-50 data-[inset]:pl-8 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",s),...l})}function d(e){let{className:s,inset:t,...i}=e;return(0,a.jsx)(r.JU,{"data-slot":"dropdown-menu-label","data-inset":t,className:(0,n.cn)("px-2 py-1.5 text-sm font-medium data-[inset]:pl-8",s),...i})}function u(e){let{className:s,...t}=e;return(0,a.jsx)(r.wv,{"data-slot":"dropdown-menu-separator",className:(0,n.cn)("bg-border -mx-1 my-1 h-px",s),...t})}},82714:(e,s,t)=>{"use strict";t.d(s,{J:()=>i});var a=t(95155);t(12115);var r=t(40968),n=t(53999);function i(e){let{className:s,...t}=e;return(0,a.jsx)(r.b,{"data-slot":"label",className:(0,n.cn)("flex items-center gap-2 text-sm leading-none font-medium select-none group-data-[disabled=true]:pointer-events-none group-data-[disabled=true]:opacity-50 peer-disabled:cursor-not-allowed peer-disabled:opacity-50",s),...t})}},88145:(e,s,t)=>{"use strict";t.d(s,{E:()=>c});var a=t(95155);t(12115);var r=t(99708),n=t(74466),i=t(53999);let l=(0,n.F)("inline-flex items-center justify-center rounded-md border px-2 py-0.5 text-xs font-medium w-fit whitespace-nowrap shrink-0 [&>svg]:size-3 gap-1 [&>svg]:pointer-events-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive transition-[color,box-shadow] overflow-hidden",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground [a&]:hover:bg-primary/90",secondary:"border-transparent bg-secondary text-secondary-foreground [a&]:hover:bg-secondary/90",destructive:"border-transparent bg-destructive text-white [a&]:hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60",outline:"text-foreground [a&]:hover:bg-accent [a&]:hover:text-accent-foreground"}},defaultVariants:{variant:"default"}});function c(e){let{className:s,variant:t,asChild:n=!1,...c}=e,o=n?r.DX:"span";return(0,a.jsx)(o,{"data-slot":"badge",className:(0,i.cn)(l({variant:t}),s),...c})}},88482:(e,s,t)=>{"use strict";t.d(s,{BT:()=>c,Wu:()=>o,ZB:()=>l,Zp:()=>n,aR:()=>i});var a=t(95155);t(12115);var r=t(53999);function n(e){let{className:s,...t}=e;return(0,a.jsx)("div",{"data-slot":"card",className:(0,r.cn)("bg-card text-card-foreground flex flex-col gap-6 rounded-xl border py-6 shadow-sm",s),...t})}function i(e){let{className:s,...t}=e;return(0,a.jsx)("div",{"data-slot":"card-header",className:(0,r.cn)("@container/card-header grid auto-rows-min grid-rows-[auto_auto] items-start gap-1.5 px-6 has-data-[slot=card-action]:grid-cols-[1fr_auto] [.border-b]:pb-6",s),...t})}function l(e){let{className:s,...t}=e;return(0,a.jsx)("div",{"data-slot":"card-title",className:(0,r.cn)("leading-none font-semibold",s),...t})}function c(e){let{className:s,...t}=e;return(0,a.jsx)("div",{"data-slot":"card-description",className:(0,r.cn)("text-muted-foreground text-sm",s),...t})}function o(e){let{className:s,...t}=e;return(0,a.jsx)("div",{"data-slot":"card-content",className:(0,r.cn)("px-6",s),...t})}},88524:(e,s,t)=>{"use strict";t.d(s,{A0:()=>i,BF:()=>l,Hj:()=>c,XI:()=>n,nA:()=>d,nd:()=>o});var a=t(95155);t(12115);var r=t(53999);function n(e){let{className:s,...t}=e;return(0,a.jsx)("div",{"data-slot":"table-container",className:"relative w-full overflow-x-auto",children:(0,a.jsx)("table",{"data-slot":"table",className:(0,r.cn)("w-full caption-bottom text-sm",s),...t})})}function i(e){let{className:s,...t}=e;return(0,a.jsx)("thead",{"data-slot":"table-header",className:(0,r.cn)("[&_tr]:border-b",s),...t})}function l(e){let{className:s,...t}=e;return(0,a.jsx)("tbody",{"data-slot":"table-body",className:(0,r.cn)("[&_tr:last-child]:border-0",s),...t})}function c(e){let{className:s,...t}=e;return(0,a.jsx)("tr",{"data-slot":"table-row",className:(0,r.cn)("hover:bg-muted/50 data-[state=selected]:bg-muted border-b transition-colors",s),...t})}function o(e){let{className:s,...t}=e;return(0,a.jsx)("th",{"data-slot":"table-head",className:(0,r.cn)("text-foreground h-10 px-2 text-left align-middle font-medium whitespace-nowrap [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]",s),...t})}function d(e){let{className:s,...t}=e;return(0,a.jsx)("td",{"data-slot":"table-cell",className:(0,r.cn)("p-2 align-middle whitespace-nowrap [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]",s),...t})}},89852:(e,s,t)=>{"use strict";t.d(s,{p:()=>n});var a=t(95155);t(12115);var r=t(53999);function n(e){let{className:s,type:t,...n}=e;return(0,a.jsx)("input",{type:t,"data-slot":"input",className:(0,r.cn)("file:text-foreground placeholder:text-muted-foreground selection:bg-primary selection:text-primary-foreground dark:bg-input/30 border-input flex h-9 w-full min-w-0 rounded-md border bg-transparent px-3 py-1 text-base shadow-xs transition-[color,box-shadow] outline-none file:inline-flex file:h-7 file:border-0 file:bg-transparent file:text-sm file:font-medium disabled:pointer-events-none disabled:cursor-not-allowed disabled:opacity-50 md:text-sm","focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px]","aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",s),...n})}},93764:(e,s,t)=>{Promise.resolve().then(t.bind(t,37049))},95139:(e,s,t)=>{"use strict";t.d(s,{S:()=>l});var a=t(95155);t(12115);var r=t(76981),n=t(5196),i=t(53999);function l(e){let{className:s,...t}=e;return(0,a.jsx)(r.bL,{"data-slot":"checkbox",className:(0,i.cn)("peer border-input dark:bg-input/30 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground dark:data-[state=checked]:bg-primary data-[state=checked]:border-primary focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive size-4 shrink-0 rounded-[4px] border shadow-xs transition-shadow outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50",s),...t,children:(0,a.jsx)(r.C1,{"data-slot":"checkbox-indicator",className:"flex items-center justify-center text-current transition-none",children:(0,a.jsx)(n.A,{className:"size-3.5"})})})}},95784:(e,s,t)=>{"use strict";t.d(s,{bq:()=>u,eb:()=>x,gC:()=>m,l6:()=>o,yv:()=>d});var a=t(95155);t(12115);var r=t(22918),n=t(66474),i=t(5196),l=t(47863),c=t(53999);function o(e){let{...s}=e;return(0,a.jsx)(r.bL,{"data-slot":"select",...s})}function d(e){let{...s}=e;return(0,a.jsx)(r.WT,{"data-slot":"select-value",...s})}function u(e){let{className:s,size:t="default",children:i,...l}=e;return(0,a.jsxs)(r.l9,{"data-slot":"select-trigger","data-size":t,className:(0,c.cn)("border-input data-[placeholder]:text-muted-foreground [&_svg:not([class*='text-'])]:text-muted-foreground focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive dark:bg-input/30 dark:hover:bg-input/50 flex w-fit items-center justify-between gap-2 rounded-md border bg-transparent px-3 py-2 text-sm whitespace-nowrap shadow-xs transition-[color,box-shadow] outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50 data-[size=default]:h-9 data-[size=sm]:h-8 *:data-[slot=select-value]:line-clamp-1 *:data-[slot=select-value]:flex *:data-[slot=select-value]:items-center *:data-[slot=select-value]:gap-2 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",s),...l,children:[i,(0,a.jsx)(r.In,{asChild:!0,children:(0,a.jsx)(n.A,{className:"size-4 opacity-50"})})]})}function m(e){let{className:s,children:t,position:n="popper",...i}=e;return(0,a.jsx)(r.ZL,{children:(0,a.jsxs)(r.UC,{"data-slot":"select-content",className:(0,c.cn)("bg-popover text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 relative z-50 max-h-(--radix-select-content-available-height) min-w-[8rem] origin-(--radix-select-content-transform-origin) overflow-x-hidden overflow-y-auto rounded-md border shadow-md","popper"===n&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",s),position:n,...i,children:[(0,a.jsx)(h,{}),(0,a.jsx)(r.LM,{className:(0,c.cn)("p-1","popper"===n&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)] scroll-my-1"),children:t}),(0,a.jsx)(g,{})]})})}function x(e){let{className:s,children:t,...n}=e;return(0,a.jsxs)(r.q7,{"data-slot":"select-item",className:(0,c.cn)("focus:bg-accent focus:text-accent-foreground [&_svg:not([class*='text-'])]:text-muted-foreground relative flex w-full cursor-default items-center gap-2 rounded-sm py-1.5 pr-8 pl-2 text-sm outline-hidden select-none data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4 *:[span]:last:flex *:[span]:last:items-center *:[span]:last:gap-2",s),...n,children:[(0,a.jsx)("span",{className:"absolute right-2 flex size-3.5 items-center justify-center",children:(0,a.jsx)(r.VF,{children:(0,a.jsx)(i.A,{className:"size-4"})})}),(0,a.jsx)(r.p4,{children:t})]})}function h(e){let{className:s,...t}=e;return(0,a.jsx)(r.PP,{"data-slot":"select-scroll-up-button",className:(0,c.cn)("flex cursor-default items-center justify-center py-1",s),...t,children:(0,a.jsx)(l.A,{className:"size-4"})})}function g(e){let{className:s,...t}=e;return(0,a.jsx)(r.wn,{"data-slot":"select-scroll-down-button",className:(0,c.cn)("flex cursor-default items-center justify-center py-1",s),...t,children:(0,a.jsx)(n.A,{className:"size-4"})})}},97168:(e,s,t)=>{"use strict";t.d(s,{$:()=>c,r:()=>l});var a=t(95155);t(12115);var r=t(99708),n=t(74466),i=t(53999);let l=(0,n.F)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg:not([class*='size-'])]:size-4 shrink-0 [&_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",{variants:{variant:{default:"bg-primary text-primary-foreground shadow-xs hover:bg-primary/90",destructive:"bg-destructive text-white shadow-xs hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60",outline:"border bg-background shadow-xs hover:bg-accent hover:text-accent-foreground dark:bg-input/30 dark:border-input dark:hover:bg-input/50",secondary:"bg-secondary text-secondary-foreground shadow-xs hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-9 px-4 py-2 has-[>svg]:px-3",sm:"h-8 rounded-md gap-1.5 px-3 has-[>svg]:px-2.5",lg:"h-10 rounded-md px-6 has-[>svg]:px-4",icon:"size-9"}},defaultVariants:{variant:"default",size:"default"}});function c(e){let{className:s,variant:t,size:n,asChild:c=!1,...o}=e,d=c?r.DX:"button";return(0,a.jsx)(d,{"data-slot":"button",className:(0,i.cn)(l({variant:t,size:n,className:s})),...o})}},97502:(e,s,t)=>{"use strict";t.d(s,{AuthProvider:()=>d,Z:()=>o});var a=t(95155),r=t(61778),n=t(35695),i=t(12115),l=t(38543);let c=(0,i.createContext)({user:null,isLoggedIn:!1,loading:!0,authChecked:!1,serverUnreachable:!1,maintenanceMode:!1,maintenanceDetails:null,login:async()=>({message:"",isAuthenticated:!1}),logout:async()=>{},refreshUser:async()=>{},retryConnection:async()=>({message:"",isAuthenticated:!1}),navigateToRoleDashboard:()=>{},getRoleBasedRedirectUrl:()=>"/"}),o=()=>(0,i.useContext)(c);function d(e){let{children:s}=e,{user:t,isAuthenticated:o,isLoading:d,authChecked:u,serverUnreachable:m,maintenanceMode:x,maintenanceDetails:h,login:g,logout:p,fetchUser:f,retryConnection:v,getRoleBasedRedirectUrl:j}=(0,r.As)(),y=(0,n.useRouter)(),b=(0,i.useRef)(!0);(0,i.useEffect)(()=>()=>{b.current=!1},[]),(0,i.useEffect)(()=>{if(!b.current||!u)return;let e=window.location.pathname,s="/login"===e||e.startsWith("/auth/")||"/maintenance"===e||"/server-unreachable"===e;if(x&&"/maintenance"!==e)y.push("/maintenance");else if(m&&"/server-unreachable"!==e)y.push("/server-unreachable");else if(o||d||s){if(o&&(null==t?void 0:t.role)&&!s){let s=_(t.role);e.startsWith(s)||y.push(s)}}else y.push("/login")},[x,m,o,d,u,t,y]);let N=async()=>{if(b.current)try{await p(),b.current&&l.oR.success("Logged out successfully")}catch(e){b.current&&l.oR.error("Error during logout")}},w=async()=>{if(b.current&&o)try{await f()}catch(e){b.current&&l.oR.error("Error refreshing user data")}},_=e=>{switch(e.toLowerCase()){case"admin":return"/admin";case"supervisor":return"/supervisor";default:return"/sales"}},A=async()=>{try{return await v()}catch(e){return b.current&&l.oR.error("Failed to reconnect to server"),{message:"Connection failed",isAuthenticated:!1,serverError:!0}}};return(0,a.jsx)(c.Provider,{value:{user:t,isLoggedIn:o,loading:d,authChecked:u,serverUnreachable:m,maintenanceMode:x,maintenanceDetails:h,login:g,logout:N,refreshUser:w,retryConnection:A,navigateToRoleDashboard:()=>{if(b.current)if(null==t?void 0:t.role){let e=_(t.role);y.push(e)}else y.push("/login")},getRoleBasedRedirectUrl:_},children:s})}}},e=>{e.O(0,[6586,4277,8543,6373,4783,8787,3438,6489,9402,1778,8441,5964,7358],()=>e(e.s=93764)),_N_E=e.O()}]);