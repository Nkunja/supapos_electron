(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9496],{45536:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>z});var a=t(95155),l=t(12115),r=t(49026),i=t(1243),n=t(38543),c=t(97168),o=t(89852),d=t(46308);function x(e){let{show:s,onClose:t,cart:l,customerDetails:r,onCustomerDetailsChange:i,paymentMethod:n,onPaymentMethodChange:x,amountPaid:m,onAmountPaidChange:u,notes:p,onNotesChange:h,onProcessTransaction:f,isProcessing:b}=e,v=l.reduce((e,s)=>{let t=(e=>{let s=e.custom_price||e.selling_price_per_piece;if("string"==typeof s){let e=parseFloat(s);return isNaN(e)?0:e}return"number"!=typeof s||isNaN(s)?0:s})(s);return e+s.quantity*t},0),j=v+0;return s?(0,a.jsx)("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:(0,a.jsx)("div",{className:"bg-white rounded-xl shadow-2xl max-w-md w-full max-h-[90vh] overflow-y-auto",children:(0,a.jsxs)("div",{className:"p-6",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,a.jsx)("h2",{className:"text-xl font-bold text-slate-900",children:"Complete Sale"}),(0,a.jsx)(c.$,{variant:"ghost",size:"sm",onClick:t,className:"text-slate-500 hover:text-slate-700",children:"âœ•"})]}),(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsx)("h3",{className:"font-semibold text-slate-900",children:"Customer Details"}),(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:"Customer Name"}),(0,a.jsx)(o.p,{placeholder:"Enter customer name (optional)",value:r.customer_name,onChange:e=>i({...r,customer_name:e.target.value}),className:"w-full"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:"Phone Number"}),(0,a.jsx)(o.p,{placeholder:"Enter phone number (optional)",value:r.customer_phone,onChange:e=>i({...r,customer_phone:e.target.value}),className:"w-full"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:"Email Address"}),(0,a.jsx)(o.p,{type:"email",placeholder:"Enter email (optional)",value:r.customer_email||"",onChange:e=>i({...r,customer_email:e.target.value}),className:"w-full"})]})]})]}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsx)("h3",{className:"font-semibold text-slate-900",children:"Payment Method"}),(0,a.jsx)("div",{className:"grid grid-cols-2 gap-3",children:[{value:"cash",label:"Cash",icon:"\uD83D\uDCB5"},{value:"card",label:"Card",icon:"\uD83D\uDCB3"},{value:"mobile",label:"M-Pesa",icon:"\uD83D\uDCF1"},{value:"bank",label:"Bank",icon:"\uD83C\uDFE6"}].map(e=>(0,a.jsxs)("button",{onClick:()=>x(e.value),className:"p-3 rounded-lg border-2 transition-all ".concat(n===e.value?"border-blue-500 bg-blue-50 text-blue-700":"border-slate-200 hover:border-slate-300"),children:[(0,a.jsx)("div",{className:"text-2xl mb-1",children:e.icon}),(0,a.jsx)("div",{className:"text-sm font-medium",children:e.label})]},e.value))})]}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsx)("h3",{className:"font-semibold text-slate-900",children:"Payment Details"}),(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:"Amount Paid"}),(0,a.jsx)(o.p,{type:"number",placeholder:"".concat(j.toFixed(2)),value:m,onChange:e=>u(e.target.value),className:"w-full",step:"0.01",min:"0"})]}),parseFloat(m||"0")>j&&(0,a.jsxs)("div",{className:"text-sm text-green-600 font-medium",children:["Change: KSh ",(parseFloat(m||"0")-j).toFixed(2)]}),parseFloat(m||"0")<j&&m&&(0,a.jsxs)("div",{className:"text-sm text-red-600 font-medium",children:["Remaining: KSh ",(j-parseFloat(m||"0")).toFixed(2)]})]})]}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsx)("h3",{className:"font-semibold text-slate-900",children:"Notes"}),(0,a.jsx)("textarea",{value:p,onChange:e=>h(e.target.value),className:"w-full p-3 border border-slate-200 rounded-lg resize-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500",rows:3,placeholder:"Enter any additional notes..."})]}),(0,a.jsxs)("div",{className:"space-y-3 p-4 bg-slate-50 rounded-lg",children:[(0,a.jsx)("h3",{className:"font-semibold text-slate-900",children:"Order Summary"}),(0,a.jsxs)("div",{className:"space-y-2 text-sm",children:[(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsxs)("span",{children:["Items (",l.length,"):"]}),(0,a.jsxs)("span",{children:[l.reduce((e,s)=>e+s.quantity,0)," pieces"]})]}),(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("span",{children:"Subtotal:"}),(0,a.jsxs)("span",{children:["KSh ",v.toFixed(2)]})]}),(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("span",{children:"Tax (VAT Exempt):"}),(0,a.jsxs)("span",{children:["KSh ","0.00"]})]}),(0,a.jsx)("div",{className:"border-t border-slate-200 pt-2",children:(0,a.jsxs)("div",{className:"flex justify-between font-semibold text-lg",children:[(0,a.jsx)("span",{children:"Total:"}),(0,a.jsxs)("span",{className:"text-blue-600",children:["KSh ",j.toFixed(2)]})]})})]})]}),(0,a.jsxs)("div",{className:"flex space-x-3",children:[(0,a.jsx)(c.$,{variant:"outline",onClick:t,className:"flex-1",disabled:b,children:"Cancel"}),(0,a.jsx)(c.$,{onClick:f,disabled:b||!m||parseFloat(m)<j,className:"flex-1 bg-gradient-to-r from-green-600 to-emerald-600 hover:from-green-700 hover:to-emerald-700",children:b?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"animate-spin rounded-full h-4 w-4 border-2 border-white border-t-transparent mr-2"}),"Creating Invoice..."]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(d.A,{className:"h-4 w-4 mr-2"}),"Create Invoice"]})})]})]})]})})}):null}var m=t(24984),u=t(88482),p=t(88145),h=t(37108),f=t(53904),b=t(47924),v=t(84616),j=t(51162);function N(e){let{cart:s,onAddToCart:t,onUpdateQuantity:r,onRemoveFromCart:i,getAvailableStock:n,lastSaleTimestamp:d,onInventoryUpdate:x}=e,[m,N]=(0,l.useState)(""),[g,_]=(0,l.useState)([]),[y,w]=(0,l.useState)(!1),[C,S]=(0,l.useState)(""),[k,F]=(0,l.useState)(null),[A,T]=(0,l.useState)(new Map),E=(0,l.useCallback)(async function(){let e=!(arguments.length>0)||void 0===arguments[0]||arguments[0],s=arguments.length>1&&void 0!==arguments[1]&&arguments[1];try{e&&!s&&w(!0),S("");let t=(await (0,j.de)(m||void 0)).results||[];return _(t),F(new Date),s&&T(new Map),x&&x(t),t}catch(e){return S("Failed to fetch products"),[]}finally{e&&!s&&w(!1)}},[m,x]);(0,l.useEffect)(()=>{let e=setTimeout(()=>{E()},300);return()=>clearTimeout(e)},[E]),(0,l.useEffect)(()=>{d&&k&&new Date(d)>k&&E(!1,!0)},[d,k,E]);let P=(0,l.useCallback)((e,s)=>{T(t=>{let a=new Map(t),l=a.get(e)||0;return a.set(e,l+s),a})},[]),q=(0,l.useCallback)(e=>{var t;let a=e.total_pieces||e.total_units*e.pieces_per_unit;return Math.max(0,a-(A.get(e.id)||0)-((null==(t=s.find(s=>s.id===e.id))?void 0:t.quantity)||0))},[A,s]),R=(0,l.useCallback)(e=>{0>=q(e)||(P(e.id,1),t(e),setTimeout(()=>{E(!1,!0)},2e3))},[t,P,q,E]),z=g.filter(e=>e.product_name.toLowerCase().includes(m.toLowerCase())||e.product_generic_name&&e.product_generic_name.toLowerCase().includes(m.toLowerCase())||e.product_description&&e.product_description.toLowerCase().includes(m.toLowerCase())||e.batch_number.includes(m)||e.barcode&&e.barcode.includes(m));return(0,a.jsxs)(u.Zp,{className:"shadow-xl border-0 bg-white/80 backdrop-blur-sm",children:[(0,a.jsxs)(u.aR,{className:"pb-4",children:[(0,a.jsxs)(u.ZB,{className:"flex items-center justify-between text-slate-900",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)("div",{className:"p-2 bg-gradient-to-r from-blue-600 to-purple-600 rounded-lg",children:(0,a.jsx)(h.A,{className:"h-5 w-5 text-white"})}),(0,a.jsx)("span",{children:"Products Catalog"}),A.size>0&&(0,a.jsx)(p.E,{className:"bg-blue-100 text-blue-700 text-xs",children:"Live Updates"})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[k&&(0,a.jsxs)("span",{className:"text-xs text-slate-500",children:["Last sync: ",k.toLocaleTimeString()]}),(0,a.jsx)(c.$,{size:"sm",variant:"outline",onClick:()=>{E(!0,!1)},disabled:y,className:"h-8 w-8 p-0",title:"Refresh inventory",children:(0,a.jsx)(f.A,{className:"h-4 w-4 ".concat(y?"animate-spin":"")})})]})]}),(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)(b.A,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-slate-400"}),(0,a.jsx)(o.p,{placeholder:"Search by name, generic name, batch, or barcode...",value:m,onChange:e=>N(e.target.value),className:"pl-12 h-12 border-slate-200 focus:border-blue-500 focus:ring-blue-500"})]})]}),(0,a.jsx)(u.Wu,{className:"p-0",children:(0,a.jsx)("div",{className:"max-h-[500px] overflow-y-auto",children:y?(0,a.jsx)("div",{className:"flex items-center justify-center py-12",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-4 border-blue-600 border-t-transparent mx-auto mb-3"}),(0,a.jsx)("p",{className:"text-slate-600 text-sm",children:"Loading products..."})]})}):C?(0,a.jsxs)("div",{className:"text-center py-12",children:[(0,a.jsx)("p",{className:"text-red-600 text-sm",children:C}),(0,a.jsx)(c.$,{size:"sm",variant:"outline",onClick:()=>E(),className:"mt-2",children:"Retry"})]}):0===z.length?(0,a.jsx)("div",{className:"text-center py-12",children:(0,a.jsx)("p",{className:"text-slate-500 text-sm",children:"No products found"})}):z.map(e=>{let t=q(e),l=s.find(s=>s.id===e.id),r=(e=>{let s=q(e);return s<=0?{status:"out_of_stock",label:"Out of Stock",className:"bg-red-100 text-red-700"}:s<=e.reorder_level?{status:"low_stock",label:"Low Stock",className:"bg-orange-100 text-orange-700"}:null})(e),i=(e=>{if(!e)return!1;let s=new Date(e),t=new Date;return t.setMonth(t.getMonth()+3),s<=t})(e.expiry_date),n=A.has(e.id);return(0,a.jsx)("div",{className:"p-4 border-b border-slate-100 hover:bg-slate-50/50 transition-colors cursor-pointer group",onClick:()=>t>0&&R(e),children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-2 mb-1 flex-wrap",children:[(0,a.jsx)("h3",{className:"font-semibold text-slate-900 group-hover:text-blue-600 transition-colors",children:e.product_name}),e.product_generic_name&&(0,a.jsxs)("span",{className:"text-sm text-slate-500 italic",children:["(",e.product_generic_name,")"]}),r&&(0,a.jsx)(p.E,{className:"text-xs ".concat(r.className),children:r.label}),i&&(0,a.jsx)(p.E,{className:"bg-yellow-100 text-yellow-700 text-xs",children:"Expiring Soon"}),l&&(0,a.jsxs)(p.E,{className:"bg-blue-100 text-blue-700 text-xs",children:[l.quantity," in cart"]}),n&&(0,a.jsx)(p.E,{className:"bg-green-100 text-green-700 text-xs",children:"Updated"})]}),e.product_description&&(0,a.jsx)("p",{className:"text-sm text-slate-600 mb-2",children:e.product_description}),(0,a.jsxs)("div",{className:"flex items-center space-x-4 flex-wrap gap-y-1",children:[(0,a.jsx)("span",{className:"text-xs px-2 py-1 bg-slate-100 text-slate-600 rounded-full",children:e.form_display||e.form}),(0,a.jsx)("span",{className:"text-xs px-2 py-1 bg-blue-50 text-blue-700 rounded-full",children:e.drug_type_display||e.drug_type}),(0,a.jsx)("span",{className:"text-xs px-2 py-1 bg-green-50 text-green-700 rounded-full",children:e.user_type_display||e.user_type}),(0,a.jsxs)("span",{className:"text-xs text-slate-500",children:["Available: ",(0,a.jsx)("span",{className:"font-medium ".concat(n?"text-blue-600":""),children:t})]}),(0,a.jsxs)("span",{className:"text-xs text-slate-500",children:["Batch: ",(0,a.jsx)("span",{className:"font-medium",children:e.batch_number})]}),e.expiry_date&&(0,a.jsxs)("span",{className:"text-xs ".concat(i?"text-yellow-600 font-medium":"text-slate-500"),children:["Exp: ",new Date(e.expiry_date).toLocaleDateString()]})]}),e.purchase_order_name&&(0,a.jsx)("div",{className:"mt-1",children:(0,a.jsxs)("span",{className:"text-xs text-slate-500",children:["Purchase Order: ",(0,a.jsx)("span",{className:"font-medium text-purple-600",children:e.purchase_order_name})]})}),e.supplier&&(0,a.jsx)("div",{className:"mt-1",children:(0,a.jsxs)("span",{className:"text-xs text-slate-500",children:["Supplier: ",(0,a.jsx)("span",{className:"font-medium",children:e.supplier})]})})]}),(0,a.jsxs)("div",{className:"text-right ml-4",children:[(0,a.jsxs)("p",{className:"font-bold text-slate-900 text-lg mb-1",children:["KSh ",parseFloat(e.selling_price_per_piece.toString()).toFixed(2)]}),(0,a.jsxs)("p",{className:"text-xs text-slate-500 mb-2",children:["per ",e.unit_of_measurement_display||e.unit_of_measurement]}),(0,a.jsxs)(c.$,{size:"sm",className:"bg-gradient-to-r from-blue-600 to-purple-600 hover:from-blue-700 hover:to-purple-700",disabled:t<=0||!e.is_active,onClick:s=>{s.stopPropagation(),t>0&&R(e)},children:[(0,a.jsx)(v.A,{className:"h-4 w-4 mr-1"}),t>0?"Add":"Out of Stock"]})]})]})},e.id)})})})]})}var g=t(76037),_=t(27809),y=t(62525),w=t(5196),C=t(54416),S=t(44940),k=t(87712);function F(e){let{cart:s,onUpdateQuantity:t,onUpdatePrice:r,onRemoveFromCart:i,onProceedToCheckout:x,isProcessing:m}=e,[u,p]=(0,l.useState)(null),[h,f]=(0,l.useState)(""),b=e=>{if(void 0!==e.custom_price&&null!==e.custom_price){let s=e.custom_price;if("number"==typeof s)return s;let t=parseFloat(String(s));return isNaN(t)?0:t}let s=e.selling_price_per_piece;if("string"==typeof s){let e=parseFloat(s);return isNaN(e)?0:e}return"number"!=typeof s||isNaN(s)?0:s},j=e=>{let s=e.selling_price_per_piece;if("string"==typeof s){let e=parseFloat(s);return isNaN(e)?0:e}return"number"!=typeof s||isNaN(s)?0:s},N=()=>s.reduce((e,s)=>e+s.quantity*b(s),0),F=()=>{p(null),f("")};return 0===s.length?(0,a.jsxs)("div",{className:"h-[550px] flex flex-col items-center justify-center bg-white rounded-xl p-8",children:[(0,a.jsx)("div",{className:"p-6 bg-slate-100 rounded-full w-20 h-20 flex items-center justify-center mb-4",children:(0,a.jsx)(_.A,{className:"h-10 w-10 text-slate-400"})}),(0,a.jsx)("h3",{className:"text-lg font-bold text-slate-900 mb-2",children:"Cart Empty"}),(0,a.jsx)("p",{className:"text-slate-500 text-center mb-4",children:"Scan or select items to start a new sale"}),(0,a.jsxs)("div",{className:"w-full bg-slate-100 rounded-lg p-4 font-mono text-center",children:[(0,a.jsx)("div",{className:"text-slate-400 text-sm",children:"Ready to scan..."}),(0,a.jsx)("div",{className:"text-2xl font-bold text-slate-600 mt-2",children:"KSh 0.00"})]})]}):(0,a.jsxs)("div",{className:"h-[600px] flex flex-col bg-white rounded-xl overflow-hidden",children:[(0,a.jsx)("div",{className:"bg-slate-50 p-2 border-b border-slate-300 flex-shrink-0",children:(0,a.jsxs)("div",{className:"text-center font-mono",children:[(0,a.jsx)("div",{className:"text-xs text-slate-600",children:"TRANSACTION RECEIPT"}),(0,a.jsx)("div",{className:"text-xs text-slate-400",children:new Date().toLocaleString()})]})}),(0,a.jsx)("div",{className:"flex-1 overflow-y-auto p-2 space-y-1.5 scrollbar-thin scrollbar-thumb-slate-300 scrollbar-track-slate-100",children:s.map(e=>{let s=b(e),l=j(e),d=e.total_pieces||e.total_units*e.pieces_per_unit,x=e.quantity*s;return(0,a.jsxs)("div",{className:"bg-slate-50 rounded-md p-2 border border-slate-200",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-1",children:[(0,a.jsx)("h4",{className:"font-semibold text-slate-900 text-xs leading-tight flex-1 pr-2",children:e.product_name}),(0,a.jsx)(c.$,{size:"sm",variant:"ghost",onClick:()=>i(e.id),className:"text-red-500 hover:text-red-700 hover:bg-red-50 h-5 w-5 p-0",children:(0,a.jsx)(y.A,{className:"h-3 w-3"})})]}),(0,a.jsxs)("div",{className:"flex items-center justify-between mb-1",children:[(0,a.jsx)("div",{className:"flex items-center space-x-1",children:u===e.id?(0,a.jsxs)("div",{className:"flex items-center space-x-1",children:[(0,a.jsx)("span",{className:"text-xs font-mono",children:"KSh"}),(0,a.jsx)(o.p,{type:"number",value:h,onChange:e=>f(e.target.value),className:"h-5 w-16 text-xs p-1 font-mono",min:l,step:"0.01"}),(0,a.jsx)(c.$,{size:"sm",variant:"ghost",onClick:()=>(e=>{let s=parseFloat(h),t=j(e);if(isNaN(s)||s<=0){n.oR.error("Price must be a valid positive number"),f(b(e).toString());return}if(s<t){n.oR.error("Price cannot be less than original price of KSh ".concat(t.toFixed(2))),f(b(e).toString());return}r(e.id,s),p(null),f("")})(e),className:"h-4 w-4 p-0 text-green-600",children:(0,a.jsx)(w.A,{className:"h-2 w-2"})}),(0,a.jsx)(c.$,{size:"sm",variant:"ghost",onClick:F,className:"h-4 w-4 p-0 text-red-500",children:(0,a.jsx)(C.A,{className:"h-2 w-2"})})]}):(0,a.jsxs)("div",{className:"flex items-center space-x-1",children:[(0,a.jsxs)("span",{className:"text-xs font-mono text-slate-600",children:["KSh ",s.toFixed(2)]}),e.is_price_edited&&(0,a.jsx)("span",{className:"text-xs text-orange-600 font-bold",children:"(CUSTOM)"}),(0,a.jsx)(c.$,{size:"sm",variant:"ghost",onClick:()=>{p(e.id),f(b(e).toString())},className:"h-3 w-3 p-0 text-slate-400 hover:text-slate-600",children:(0,a.jsx)(S.A,{className:"h-2 w-2"})})]})}),(0,a.jsxs)("div",{className:"text-xs font-bold text-slate-900 font-mono",children:["KSh ",x.toFixed(2)]})]}),(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-1",children:[(0,a.jsx)(c.$,{size:"sm",variant:"outline",onClick:()=>t(e.id,-1),disabled:e.quantity<=1,className:"h-5 w-5 p-0 bg-red-50 border-red-200 hover:bg-red-100",children:(0,a.jsx)(k.A,{className:"h-2 w-2 text-red-600"})}),(0,a.jsx)("div",{className:"w-6 text-center",children:(0,a.jsx)("span",{className:"text-xs font-bold",children:e.quantity})}),(0,a.jsx)(c.$,{size:"sm",variant:"outline",onClick:()=>t(e.id,1),disabled:e.quantity>=d,className:"h-5 w-5 p-0 bg-green-50 border-green-200 hover:bg-green-100",children:(0,a.jsx)(v.A,{className:"h-2 w-2 text-green-600"})})]}),(0,a.jsxs)("div",{className:"text-xs text-slate-500",children:["Stock: ",d]})]}),e.is_price_edited&&s!==l&&(0,a.jsxs)("div",{className:"text-xs text-slate-400 line-through font-mono mt-1",children:["Was: KSh ",l.toFixed(2)]})]},e.id)})}),(0,a.jsxs)("div",{className:"bg-slate-50 p-3 border-t border-slate-300 flex-shrink-0",children:[(0,a.jsxs)("div",{className:"space-y-1 font-mono",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center text-xs",children:[(0,a.jsx)("span",{className:"text-slate-600",children:"SUBTOTAL:"}),(0,a.jsxs)("span",{className:"font-semibold",children:["KSh ",N().toFixed(2)]})]}),(0,a.jsxs)("div",{className:"flex justify-between items-center text-xs",children:[(0,a.jsx)("span",{className:"text-slate-600",children:"TAX (NON-VAT):"}),(0,a.jsx)("span",{children:"KSh 0.00"})]}),(0,a.jsx)(g.w,{className:"border-dashed my-1"}),(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsx)("span",{className:"text-sm font-bold text-slate-900",children:"TOTAL:"}),(0,a.jsxs)("span",{className:"text-lg font-bold text-slate-900",children:["KSh ",N().toFixed(2)]})]})]}),(0,a.jsx)(c.$,{onClick:x,disabled:m,className:"w-full h-10 mt-2 bg-gradient-to-r from-green-600 to-emerald-600 hover:from-green-700 hover:to-emerald-700 font-bold text-sm shadow-lg",children:m?(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)("div",{className:"animate-spin rounded-full h-3 w-3 border-2 border-white border-t-transparent"}),(0,a.jsx)("span",{children:"Processing..."})]}):(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)(d.A,{className:"h-4 w-4"}),(0,a.jsxs)("span",{children:["CHECKOUT - KSh ",N().toFixed(2)]})]})})]})]})}var A=t(14186),T=t(55868),E=t(15968),P=t(54653),q=t(71007);function R(e){let{cart:s,onAddToCart:t,onUpdateQuantity:r,onUpdatePrice:i,onRemoveFromCart:n,onProceedToCheckout:o,isProcessing:d,getAvailableStock:x}=e,[m,u]=(0,l.useState)(""),[p,h]=(0,l.useState)("grid"),[f,b]=(0,l.useState)(new Date);(0,l.useState)(()=>{let e=setInterval(()=>b(new Date),1e3);return()=>clearInterval(e)});let v=s.reduce((e,s)=>e+s.quantity,0),j=s.reduce((e,s)=>{let t=s.custom_price||("string"==typeof s.selling_price_per_piece?parseFloat(s.selling_price_per_piece):s.selling_price_per_piece);return e+s.quantity*t},0);return(0,a.jsxs)("div",{className:"min-h-screen",children:[(0,a.jsx)("div",{className:"bg-white/95 backdrop-blur-sm border-b border-slate-200 sticky top-0 z-40",children:(0,a.jsx)("div",{className:"px-6 py-4",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("div",{className:"flex items-center space-x-6",children:(0,a.jsxs)("div",{className:"flex items-center space-x-2 text-black",children:[(0,a.jsx)(A.A,{className:"h-4 w-4"}),(0,a.jsx)("span",{className:"text-sm font-mono",children:f.toLocaleTimeString()}),(0,a.jsx)("span",{className:"text-xs text-slate-500",children:f.toLocaleDateString()})]})}),(0,a.jsxs)("div",{className:"flex items-center space-x-6",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-2 bg-slate-100 px-3 py-2 rounded-lg",children:[(0,a.jsx)(_.A,{className:"h-4 w-4 text-blue-600"}),(0,a.jsxs)("span",{className:"text-sm text-black",children:[v," items"]})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-2 bg-slate-100 px-3 py-2 rounded-lg",children:[(0,a.jsx)(T.A,{className:"h-4 w-4 text-green-600"}),(0,a.jsxs)("span",{className:"text-sm text-black",children:["KSh ",j.toFixed(2)]})]})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,a.jsx)(c.$,{variant:"outline",size:"sm",onClick:()=>h("grid"===p?"list":"grid"),className:"bg-slate-100 border-slate-300 text-black hover:bg-slate-200",children:"grid"===p?(0,a.jsx)(E.A,{className:"h-4 w-4"}):(0,a.jsx)(P.A,{className:"h-4 w-4"})}),(0,a.jsxs)("div",{className:"flex items-center space-x-2 bg-slate-100 px-3 py-2 rounded-lg",children:[(0,a.jsx)(q.A,{className:"h-4 w-4 text-slate-600"}),(0,a.jsx)("span",{className:"text-sm text-black",children:"Cashier"})]})]})]})})}),(0,a.jsxs)("div",{className:"flex min-h-[calc(100vh-140px)]",children:[(0,a.jsx)("div",{className:"flex-1 p-6",children:(0,a.jsx)("div",{className:"h-full",children:(0,a.jsx)(N,{cart:s,onAddToCart:t,onUpdateQuantity:r,onRemoveFromCart:n,getAvailableStock:x})})}),(0,a.jsx)("div",{className:"w-96 p-2 border-l border-slate-200",children:(0,a.jsx)("div",{className:"min-h-screen",children:(0,a.jsx)(F,{cart:s,onUpdateQuantity:r,onUpdatePrice:i,onRemoveFromCart:n,onProceedToCheckout:o,isProcessing:d})})})]})]})}function z(){let[e,s]=(0,l.useState)([]),[t,c]=(0,l.useState)(null),[o,d]=(0,l.useState)(!1),[u,p]=(0,l.useState)(""),[h,f]=(0,l.useState)({customer_name:"",customer_phone:"",customer_email:""}),[b,v]=(0,l.useState)("cash"),[N,g]=(0,l.useState)(""),[_,y]=(0,l.useState)("Thank You For Shopping with us!"),[w,C]=(0,l.useState)(!1),[S,k]=(0,l.useState)(null);(0,l.useEffect)(()=>{(async()=>{try{let e=await (0,j.sV)("30");c(e)}catch(e){console.error("Error loading sales stats:",e),n.oR.error("Failed to load sales statistics"),c({shop:{id:1,name:"Business"},period_days:30,summary:{total_sales:0,total_invoices:0,total_items_sold:0,average_invoice_value:0},top_products:[]})}})()},[]);let F=(s,t)=>{let a=e.find(e=>e.id===s);return(t.total_pieces||t.total_units*t.pieces_per_unit)-(a?a.quantity:0)},A=async()=>{if(0===e.length)return void n.oR.error("Cart is empty");d(!0);try{let t=e.reduce((e,s)=>{let t=s.custom_price||s.selling_price_per_piece;return e+s.quantity*t},0),a=t+0-0,l=parseFloat(N)||a,r=l-a,i={shop:e.length>0?e[0].shop:1,customer_name:h.customer_name||"Walk-in Customer",customer_phone:h.customer_phone||"",customer_email:h.customer_email||"",payment_method:b,status:"completed",subtotal:t.toFixed(2),tax_amount:"0.00",discount_amount:"0.00",discount_type:"fixed",total_amount:a.toFixed(2),amount_paid:l.toFixed(2),change_amount:r.toFixed(2),notes:_,items:e.map(e=>({inventory:e.id,quantity:e.quantity,unit_price:(e.custom_price||e.selling_price_per_piece).toString(),line_total:(e.quantity*(e.custom_price||e.selling_price_per_piece)).toFixed(2),custom_price:e.custom_price}))},o=await (0,j.Aq)(i);try{k(o.invoice),n.oR.success("Invoice created successfully! Invoice preview is now open for printing.")}catch(e){console.error("Error setting invoice preview:",e),n.oR.error("Invoice created but preview failed to load")}s([]),f({customer_name:"",customer_phone:"",customer_email:""}),g(""),v("cash"),y("Thank you for shopping with us"),C(!1);try{let e=await (0,j.sV)("30");c(e)}catch(e){console.error("Error refreshing sales stats:",e)}}catch(e){console.error("Error creating invoice:",e),n.oR.error("Failed to create invoice. Please try again.")}finally{d(!1)}};return(0,a.jsxs)("div",{className:"space-y-6",children:[u&&(0,a.jsxs)(r.Fc,{variant:"destructive",children:[(0,a.jsx)(i.A,{className:"h-4 w-4"}),(0,a.jsx)(r.TN,{children:u})]}),(0,a.jsx)(R,{cart:e,onAddToCart:t=>{let a=t.total_pieces||t.total_units*t.pieces_per_unit;if(0>=F(t.id,t)){p("".concat(t.product_name," is out of stock")),n.oR.error("".concat(t.product_name," is out of stock")),setTimeout(()=>p(""),3e3);return}let l=e.find(e=>e.id===t.id);l?l.quantity<a?s(e.map(e=>e.id===t.id?{...e,quantity:e.quantity+1,line_total:(e.quantity+1)*(e.custom_price||e.selling_price_per_piece)}:e)):(p("Only ".concat(a," pieces available for ").concat(t.product_name)),n.oR.warning("Only ".concat(a," pieces available for ").concat(t.product_name)),setTimeout(()=>p(""),3e3)):(s([...e,{...t,quantity:1,line_total:t.selling_price_per_piece,custom_price:void 0,is_price_edited:!1}]),n.oR.success("Added ".concat(t.product_name," to cart")))},onUpdateQuantity:(t,a)=>{e.find(e=>e.id===t)&&s(e=>e.map(e=>{if(e.id===t){let s=Math.max(0,e.quantity+a),t=e.total_pieces||e.total_units*e.pieces_per_unit;if(s>t)return p("Only ".concat(t," pieces available for ").concat(e.product_name)),n.oR.warning("Only ".concat(t," pieces available for ").concat(e.product_name)),setTimeout(()=>p(""),3e3),e;if(0===s)return null;let l=e.custom_price||e.selling_price_per_piece;return{...e,quantity:s,line_total:s*l}}return e}).filter(Boolean))},onUpdatePrice:(e,t)=>{s(s=>s.map(s=>{if(s.id===e){let e=t!==s.selling_price_per_piece;return{...s,custom_price:e?t:void 0,is_price_edited:e,line_total:t*s.quantity}}return s}))},onRemoveFromCart:t=>{let a=e.find(e=>e.id===t);s(e.filter(e=>e.id!==t)),a&&n.oR.info("Removed ".concat(a.product_name," from cart"))},onProceedToCheckout:()=>C(!0),isProcessing:o,getAvailableStock:F}),(0,a.jsx)(x,{show:w,onClose:()=>C(!1),cart:e,customerDetails:h,onCustomerDetailsChange:f,paymentMethod:b,onPaymentMethodChange:v,amountPaid:N,onAmountPaidChange:g,notes:_,onNotesChange:y,onProcessTransaction:A,isProcessing:o}),(0,a.jsx)(m.f,{invoice:S,onClose:()=>{k(null)},onDownload:e=>{console.log("Download invoice:",e),n.oR.info("Download functionality coming soon")},onPrint:e=>{console.log("Print invoice:",e)}})]})}},49026:(e,s,t)=>{"use strict";t.d(s,{Fc:()=>n,TN:()=>c});var a=t(95155);t(12115);var l=t(74466),r=t(53999);let i=(0,l.F)("relative w-full rounded-lg border px-4 py-3 text-sm grid has-[>svg]:grid-cols-[calc(var(--spacing)*4)_1fr] grid-cols-[0_1fr] has-[>svg]:gap-x-3 gap-y-0.5 items-start [&>svg]:size-4 [&>svg]:translate-y-0.5 [&>svg]:text-current",{variants:{variant:{default:"bg-card text-card-foreground",destructive:"text-destructive bg-card [&>svg]:text-current *:data-[slot=alert-description]:text-destructive/90"}},defaultVariants:{variant:"default"}});function n(e){let{className:s,variant:t,...l}=e;return(0,a.jsx)("div",{"data-slot":"alert",role:"alert",className:(0,r.cn)(i({variant:t}),s),...l})}function c(e){let{className:s,...t}=e;return(0,a.jsx)("div",{"data-slot":"alert-description",className:(0,r.cn)("text-muted-foreground col-start-2 grid justify-items-start gap-1 text-sm [&_p]:leading-relaxed",s),...t})}},58194:(e,s,t)=>{Promise.resolve().then(t.bind(t,45536))},76037:(e,s,t)=>{"use strict";t.d(s,{w:()=>i});var a=t(95155);t(12115);var l=t(87489),r=t(53999);function i(e){let{className:s,orientation:t="horizontal",decorative:i=!0,...n}=e;return(0,a.jsx)(l.b,{"data-slot":"separator",decorative:i,orientation:t,className:(0,r.cn)("bg-border shrink-0 data-[orientation=horizontal]:h-px data-[orientation=horizontal]:w-full data-[orientation=vertical]:h-full data-[orientation=vertical]:w-px",s),...n})}},89852:(e,s,t)=>{"use strict";t.d(s,{p:()=>r});var a=t(95155);t(12115);var l=t(53999);function r(e){let{className:s,type:t,...r}=e;return(0,a.jsx)("input",{type:t,"data-slot":"input",className:(0,l.cn)("file:text-foreground placeholder:text-muted-foreground selection:bg-primary selection:text-primary-foreground dark:bg-input/30 border-input flex h-9 w-full min-w-0 rounded-md border bg-transparent px-3 py-1 text-base shadow-xs transition-[color,box-shadow] outline-none file:inline-flex file:h-7 file:border-0 file:bg-transparent file:text-sm file:font-medium disabled:pointer-events-none disabled:cursor-not-allowed disabled:opacity-50 md:text-sm","focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px]","aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",s),...r})}}},e=>{e.O(0,[6586,4277,8543,6373,3884,1778,3114,3439,8441,5964,7358],()=>e(e.s=58194)),_N_E=e.O()}]);