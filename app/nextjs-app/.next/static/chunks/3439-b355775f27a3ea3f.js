"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3439],{24984:(n,e,a)=>{a.d(e,{f:()=>x});var t=a(95155),s=a(12115),i=a(88482),r=a(97168),o=a(88145),c=a(5196),d=a(24357),l=a(91788),p=a(81304),m=a(54416);function x(n){let{invoice:e,onClose:a,onDownload:x,onPrint:h}=n,[u,v]=(0,s.useState)(!1);if(!e)return null;let f=n=>new Date(n).toLocaleDateString("en-US",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}),g=async()=>{try{let n=b();await navigator.clipboard.writeText(n),v(!0),setTimeout(()=>v(!1),2e3)}catch(n){console.error("Failed to copy to clipboard:",n)}},b=()=>{let n=["=".repeat(32),"    ".concat(e.shop_name),"P.O. Box: ".concat(e.shop_po_box||"N/A"),"Address: ".concat(e.shop_address||"N/A"),"Phone: ".concat(e.shop_phone_number||"N/A"),"KRA PIN: ".concat(e.shop_kra_pin||"N/A"),"=".repeat(32),"Invoice: ".concat(e.invoice_number),"Date: ".concat(f(e.created_at)),"Customer: ".concat(e.customer_name),"Phone: ".concat(e.customer_phone||"N/A"),"Cashier: ".concat(e.created_by_name),"-".repeat(32),"ITEMS:","-".repeat(32)];return e.items.forEach(e=>{n.push("".concat(e.product_name),"  ".concat(e.quantity," \xd7 ").concat(parseFloat(e.unit_price).toFixed(2)," = ").concat(parseFloat(e.total_price).toFixed(2)))}),n.push("-".repeat(32),"Subtotal: ".concat(parseFloat(e.subtotal).toFixed(2)),"Tax: ".concat(parseFloat(e.tax_amount).toFixed(2)),"Discount: ".concat(parseFloat(e.discount_amount).toFixed(2)),"=".repeat(32),"TOTAL: ".concat(parseFloat(e.total_amount).toFixed(2)),"Paid: ".concat(parseFloat(e.amount_paid).toFixed(2)),"Change: ".concat(parseFloat(e.change_amount).toFixed(2)),"=".repeat(32),"Payment: ".concat(e.payment_method_display),"Status: ".concat(e.status_display),"",e.notes||"","","Thank you for your purchase!","=".repeat(32)),n.join("\n")};return(0,t.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:(0,t.jsxs)(i.Zp,{className:"w-full max-w-2xl max-h-[90vh] overflow-hidden",children:[(0,t.jsxs)(i.aR,{className:"flex flex-row items-center justify-between space-y-0 pb-4",children:[(0,t.jsx)(i.ZB,{className:"text-lg",children:"Thermal Invoice Preview"}),(0,t.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,t.jsxs)(r.$,{size:"sm",variant:"outline",onClick:g,className:"flex items-center space-x-1",children:[u?(0,t.jsx)(c.A,{className:"h-4 w-4"}):(0,t.jsx)(d.A,{className:"h-4 w-4"}),(0,t.jsx)("span",{children:u?"Copied!":"Copy"})]}),(0,t.jsx)(r.$,{size:"sm",variant:"outline",onClick:()=>x(e),children:(0,t.jsx)(l.A,{className:"h-4 w-4"})}),(0,t.jsx)(r.$,{size:"sm",variant:"outline",onClick:()=>{let n=window.open("","_blank");n&&(n.document.write("\n        <html>\n          <head>\n            <title>Invoice ".concat(e.invoice_number,'</title>\n            <style>\n              @page {\n                size: 80mm 297mm;\n                margin: 0;\n              }\n              \n              @media print {\n                body {\n                  width: 72mm;\n                  max-width: 72mm;\n                  margin: 0;\n                  padding: 4mm;\n                  font-family: monospace;\n                  font-size: 11px;\n                  line-height: 1.3;\n                  transform: none !important;\n                }\n              }\n              \n              body { \n                font-family: monospace; \n                font-size: 11px; \n                margin: 0; \n                padding: 4mm;\n                width: 72mm;\n                max-width: 72mm;\n                line-height: 1.3;\n                background: white;\n                word-wrap: break-word;\n                overflow-wrap: break-word;\n              }\n              \n              .header { \n                text-align: center; \n                margin-bottom: 6px; \n                border-bottom: 1px dashed #000;\n                padding-bottom: 6px;\n              }\n              \n              .header h2 {\n                margin: 0;\n                font-size: 15px;\n                font-weight: bold;\n              }\n              \n              .header p {\n                margin: 2px 0 0 0;\n                font-size: 9px;\n              }\n              \n              .divider { \n                border-top: 1px dashed #000; \n                margin: 3px 0; \n                height: 1px;\n              }\n              \n              .item { \n                margin: 3px 0; \n                padding: 2px 0;\n              }\n              \n              .item-name {\n                font-weight: bold;\n                font-size: 10px;\n                margin-bottom: 1px;\n                word-break: break-word;\n              }\n              \n              .item-details {\n                font-size: 9px;\n                text-align: right;\n                margin-top: 1px;\n              }\n              \n              .total { \n                font-weight: bold; \n                margin-top: 6px; \n                border-top: 1px solid #000;\n                padding-top: 3px;\n              }\n              \n              .footer { \n                text-align: center; \n                margin-top: 6px; \n                border-top: 1px dashed #000;\n                padding-top: 6px;\n              }\n              \n              .info-row {\n                display: flex;\n                justify-content: space-between;\n                margin: 2px 0;\n                font-size: 9px;\n                align-items: flex-start;\n              }\n              \n              .info-label {\n                font-weight: bold;\n                flex-shrink: 0;\n                margin-right: 4px;\n              }\n              \n              .info-value {\n                text-align: right;\n                flex: 1;\n                word-break: break-all;\n              }\n              \n              .items-section {\n                margin: 6px 0;\n                border-top: 1px dashed #000;\n                border-bottom: 1px dashed #000;\n                padding: 3px 0;\n              }\n              \n              .items-header {\n                text-align: center;\n                font-weight: bold;\n                font-size: 10px;\n                margin-bottom: 3px;\n              }\n              \n              .summary-section {\n                margin: 6px 0;\n              }\n              \n              .summary-row {\n                display: flex;\n                justify-content: space-between;\n                margin: 1px 0;\n                font-size: 9px;\n                align-items: flex-start;\n              }\n              \n              .summary-row span:first-child {\n                flex-shrink: 0;\n                margin-right: 4px;\n              }\n              \n              .summary-row span:last-child {\n                text-align: right;\n                flex: 1;\n              }\n              \n              .total-row {\n                display: flex;\n                justify-content: space-between;\n                margin: 3px 0;\n                font-size: 11px;\n                font-weight: bold;\n                border-top: 1px solid #000;\n                padding-top: 3px;\n                align-items: flex-start;\n              }\n              \n              .total-row span:first-child {\n                flex-shrink: 0;\n                margin-right: 4px;\n              }\n              \n              .total-row span:last-child {\n                text-align: right;\n                flex: 1;\n              }\n              \n              .payment-info {\n                margin: 6px 0;\n                border-top: 1px dashed #000;\n                padding-top: 3px;\n              }\n              \n              .notes {\n                margin: 6px 0;\n                border-top: 1px dashed #000;\n                padding-top: 3px;\n                font-size: 9px;\n                text-align: center;\n                word-break: break-word;\n              }\n              \n              .notes strong {\n                display: block;\n                margin-bottom: 2px;\n              }\n            </style>\n          </head>\n          <body>\n            <div class="header">\n              <h2>').concat(e.shop_name,"</h2>\n              <p>P.O. Box: ").concat(e.shop_po_box||"N/A","</p>\n              <p>").concat(e.shop_address||"N/A","</p>\n              <p>Phone: ").concat(e.shop_phone_number||"N/A","</p>\n              <p>KRA PIN: ").concat(e.shop_kra_pin||"N/A",'</p>\n            </div>\n            \n            <div class="info-row">\n              <span class="info-label">Invoice:</span>\n              <span class="info-value">').concat(e.invoice_number,'</span>\n            </div>\n            <div class="info-row">\n              <span class="info-label">Date:</span>\n              <span class="info-value">').concat(f(e.created_at),'</span>\n            </div>\n            <div class="info-row">\n              <span class="info-label">Customer:</span>\n              <span class="info-value">').concat(e.customer_name,"</span>\n            </div>\n            ").concat(e.customer_phone?'<div class="info-row">\n              <span class="info-label">Phone:</span>\n              <span class="info-value">'.concat(e.customer_phone,"</span>\n            </div>"):"",'\n            <div class="info-row">\n              <span class="info-label">Cashier:</span>\n              <span class="info-value">').concat(e.created_by_name,'</span>\n            </div>\n            \n            <div class="items-section">\n              <div class="items-header">ITEMS</div>\n              ').concat(e.items.map(n=>'\n                <div class="item">\n                  <div class="item-name">'.concat(n.product_name,'</div>\n                  <div class="item-details">').concat(n.quantity," \xd7 ").concat(parseFloat(n.unit_price).toFixed(2)," = ").concat(parseFloat(n.total_price).toFixed(2),"</div>\n                </div>\n              ")).join(""),'\n            </div>\n            \n            <div class="summary-section">\n              <div class="summary-row">\n                <span>Subtotal:</span>\n                <span>').concat(parseFloat(e.subtotal).toFixed(2),'</span>\n              </div>\n              <div class="summary-row">\n                <span>Tax:</span>\n                <span>').concat(parseFloat(e.tax_amount).toFixed(2),"</span>\n              </div>\n              ").concat(parseFloat(e.discount_amount)>0?'<div class="summary-row">\n                <span>Discount:</span>\n                <span>-'.concat(parseFloat(e.discount_amount).toFixed(2),"</span>\n              </div>"):"",'\n            </div>\n            \n            <div class="total-row">\n              <span>TOTAL:</span>\n              <span>KSh ').concat(parseFloat(e.total_amount).toFixed(2),'</span>\n            </div>\n            <div class="summary-row">\n              <span>Paid:</span>\n              <span>KSh ').concat(parseFloat(e.amount_paid).toFixed(2),"</span>\n            </div>\n            ").concat(parseFloat(e.change_amount)>0?'<div class="summary-row">\n              <span>Change:</span>\n              <span>KSh '.concat(parseFloat(e.change_amount).toFixed(2),"</span>\n            </div>"):"",'\n            \n            <div class="payment-info">\n              <div class="summary-row">\n                <span>Payment Method:</span>\n                <span>').concat(e.payment_method_display,'</span>\n              </div>\n              <div class="summary-row">\n                <span>Status:</span>\n                <span>').concat(e.status_display,"</span>\n              </div>\n            </div>\n            \n            ").concat(e.notes?'<div class="notes">\n              <strong>Notes:</strong>\n              <div>'.concat(e.notes,"</div>\n            </div>"):"",'\n            \n            <div class="footer">\n              <div style="font-weight: bold; margin-bottom: 3px; font-size: 10px;">Thank You for Shopping with Us!</div>\n            </div>\n          </body>\n        </html>\n      ')),n.document.close(),n.onload=function(){n.print(),n.close()},setTimeout(()=>{n.print(),n.close()},500))},children:(0,t.jsx)(p.A,{className:"h-4 w-4"})}),(0,t.jsx)(r.$,{size:"sm",variant:"outline",onClick:a,children:(0,t.jsx)(m.A,{className:"h-4 w-4"})})]})]}),(0,t.jsx)(i.Wu,{className:"overflow-y-auto max-h-[calc(90vh-120px)]",children:(0,t.jsxs)("div",{className:"bg-white border-2 border-gray-300 rounded-lg p-4 font-mono text-sm",children:[(0,t.jsxs)("div",{className:"text-center mb-4",children:[(0,t.jsx)("div",{className:"text-lg font-bold",children:e.shop_name}),(0,t.jsxs)("div",{className:"text-xs text-gray-600",children:["P.O. Box: ",e.shop_po_box||"N/A"]}),(0,t.jsx)("div",{className:"text-xs text-gray-600",children:e.shop_address||"N/A"}),(0,t.jsxs)("div",{className:"text-xs text-gray-600",children:["Phone: ",e.shop_phone_number||"N/A"]}),(0,t.jsxs)("div",{className:"text-xs text-gray-600",children:["KRA PIN: ",e.shop_kra_pin||"N/A"]})]}),(0,t.jsxs)("div",{className:"space-y-2 mb-4",children:[(0,t.jsxs)("div",{className:"flex justify-between",children:[(0,t.jsx)("span",{children:"Invoice:"}),(0,t.jsx)("span",{className:"font-bold",children:e.invoice_number})]}),(0,t.jsxs)("div",{className:"flex justify-between",children:[(0,t.jsx)("span",{children:"Date:"}),(0,t.jsx)("span",{children:f(e.created_at)})]}),(0,t.jsxs)("div",{className:"flex justify-between",children:[(0,t.jsx)("span",{children:"Customer:"}),(0,t.jsx)("span",{children:e.customer_name})]}),e.customer_phone&&(0,t.jsxs)("div",{className:"flex justify-between",children:[(0,t.jsx)("span",{children:"Phone:"}),(0,t.jsx)("span",{children:e.customer_phone})]}),(0,t.jsxs)("div",{className:"flex justify-between",children:[(0,t.jsx)("span",{children:"Cashier:"}),(0,t.jsx)("span",{children:e.created_by_name})]})]}),(0,t.jsxs)("div",{className:"border-t border-b border-gray-300 py-2 mb-4",children:[(0,t.jsx)("div",{className:"text-center font-bold mb-2",children:"ITEMS"}),e.items.map((n,e)=>(0,t.jsxs)("div",{className:"mb-2",children:[(0,t.jsx)("div",{className:"font-medium",children:n.product_name}),(0,t.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,t.jsxs)("span",{children:[n.quantity," \xd7 ",parseFloat(n.unit_price).toFixed(2)]}),(0,t.jsx)("span",{className:"font-bold",children:parseFloat(n.total_price).toFixed(2)})]})]},n.id))]}),(0,t.jsxs)("div",{className:"space-y-1 mb-4",children:[(0,t.jsxs)("div",{className:"flex justify-between",children:[(0,t.jsx)("span",{children:"Subtotal:"}),(0,t.jsx)("span",{children:parseFloat(e.subtotal).toFixed(2)})]}),(0,t.jsxs)("div",{className:"flex justify-between",children:[(0,t.jsx)("span",{children:"Tax:"}),(0,t.jsx)("span",{children:parseFloat(e.tax_amount).toFixed(2)})]}),parseFloat(e.discount_amount)>0&&(0,t.jsxs)("div",{className:"flex justify-between",children:[(0,t.jsx)("span",{children:"Discount:"}),(0,t.jsxs)("span",{children:["-",parseFloat(e.discount_amount).toFixed(2)]})]})]}),(0,t.jsxs)("div",{className:"border-t-2 border-gray-300 pt-2 mb-4",children:[(0,t.jsxs)("div",{className:"flex justify-between text-lg font-bold",children:[(0,t.jsx)("span",{children:"TOTAL:"}),(0,t.jsxs)("span",{children:["KSh ",parseFloat(e.total_amount).toFixed(2)]})]}),(0,t.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,t.jsx)("span",{children:"Paid:"}),(0,t.jsxs)("span",{children:["KSh ",parseFloat(e.amount_paid).toFixed(2)]})]}),parseFloat(e.change_amount)>0&&(0,t.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,t.jsx)("span",{children:"Change:"}),(0,t.jsxs)("span",{children:["KSh ",parseFloat(e.change_amount).toFixed(2)]})]})]}),(0,t.jsxs)("div",{className:"space-y-1 mb-4 text-sm",children:[(0,t.jsxs)("div",{className:"flex justify-between",children:[(0,t.jsx)("span",{children:"Payment Method:"}),(0,t.jsx)("span",{children:e.payment_method_display})]}),(0,t.jsxs)("div",{className:"flex justify-between",children:[(0,t.jsx)("span",{children:"Status:"}),(0,t.jsx)(o.E,{variant:"outline",className:"text-xs",children:e.status_display})]})]}),e.notes&&(0,t.jsx)("div",{className:"border-t border-gray-300 pt-2 mb-4",children:(0,t.jsxs)("div",{className:"text-sm",children:[(0,t.jsx)("div",{className:"font-medium mb-1",children:"Notes:"}),(0,t.jsx)("div",{className:"text-gray-600",children:e.notes})]})}),(0,t.jsx)("div",{className:"text-center text-sm",children:(0,t.jsx)("div",{className:"text-gray-600",children:"Please keep this receipt for your records"})})]})})]})})}},39740:(n,e,a)=>{a.d(e,{t:()=>i}),a(8102);var t=a(61778);let s="".concat("https://supa.sirnkunja.co.ke/","api/invoices/sales_summary/?period_days=30"),i=async function(){let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"30";arguments.length>1&&void 0!==arguments[1]&&arguments[1];try{return console.log("\uD83D\uDD04 Fetching sales summary from API for ".concat(n," days")),(await t.default.get("".concat(s,"?period_days=").concat(n))).data}catch(n){throw Error("Failed to fetch sales summary.")}}},51162:(n,e,a)=>{a.d(e,{Aq:()=>x,Cb:()=>p,de:()=>m,my:()=>l,sV:()=>d}),a(8102);var t=a(61778);let s="".concat("https://supa.sirnkunja.co.ke/","api/invoices/"),i=async n=>{try{let e=new URLSearchParams;(null==n?void 0:n.page)&&e.append("page",n.page),(null==n?void 0:n.search)&&e.append("search",n.search),(null==n?void 0:n.status)&&e.append("status",n.status),(null==n?void 0:n.date_from)&&e.append("date_from",n.date_from),(null==n?void 0:n.date_to)&&e.append("date_to",n.date_to),(null==n?void 0:n.shop)&&e.append("shop",n.shop);let a=e.toString()?"".concat(s,"?").concat(e.toString()):s;return(await t.default.get(a)).data}catch(n){throw Error("Failed to fetch invoices.")}},r=async n=>{try{return(await t.default.post(s,n)).data}catch(n){throw Error("Failed to create invoice.")}};var o=a(43114),c=a(39740);let d=async function(){let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"30";try{return await (0,c.t)(n)}catch(n){throw Error("Failed to fetch sales statistics.")}},l=async function(){let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10;arguments.length>1&&void 0!==arguments[1]&&arguments[1];try{console.log("\uD83D\uDD04 Fetching recent invoices from API");let e=await i({page:"1"});return Array.isArray(null==e?void 0:e.results)&&e.results.length&&(e.results=e.results.slice(0,n)),e}catch(n){throw Error("Failed to fetch recent invoices.")}},p=async function(){arguments.length>0&&void 0!==arguments[0]&&arguments[0];try{console.log("\uD83D\uDD04 Fetching fresh invoices from API");let n=await i({});return Array.isArray(null==n?void 0:n.results)&&n.results.length&&(n.results=n.results.slice(0,n.count)),n}catch(n){throw Error("Failed to fetch all invoices.")}},m=async n=>{try{return await (0,o.ZK)({search:n})}catch(n){throw Error("Failed to fetch products for sale.")}},x=async n=>{try{return await r(n)}catch(n){throw Error("Failed to create sales invoice.")}}},53999:(n,e,a)=>{a.d(e,{cn:()=>i});var t=a(52596),s=a(39688);function i(){for(var n=arguments.length,e=Array(n),a=0;a<n;a++)e[a]=arguments[a];return(0,s.QP)((0,t.$)(e))}},88145:(n,e,a)=>{a.d(e,{E:()=>c});var t=a(95155);a(12115);var s=a(99708),i=a(74466),r=a(53999);let o=(0,i.F)("inline-flex items-center justify-center rounded-md border px-2 py-0.5 text-xs font-medium w-fit whitespace-nowrap shrink-0 [&>svg]:size-3 gap-1 [&>svg]:pointer-events-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive transition-[color,box-shadow] overflow-hidden",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground [a&]:hover:bg-primary/90",secondary:"border-transparent bg-secondary text-secondary-foreground [a&]:hover:bg-secondary/90",destructive:"border-transparent bg-destructive text-white [a&]:hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60",outline:"text-foreground [a&]:hover:bg-accent [a&]:hover:text-accent-foreground"}},defaultVariants:{variant:"default"}});function c(n){let{className:e,variant:a,asChild:i=!1,...c}=n,d=i?s.DX:"span";return(0,t.jsx)(d,{"data-slot":"badge",className:(0,r.cn)(o({variant:a}),e),...c})}},88482:(n,e,a)=>{a.d(e,{BT:()=>c,Wu:()=>d,ZB:()=>o,Zp:()=>i,aR:()=>r});var t=a(95155);a(12115);var s=a(53999);function i(n){let{className:e,...a}=n;return(0,t.jsx)("div",{"data-slot":"card",className:(0,s.cn)("bg-card text-card-foreground flex flex-col gap-6 rounded-xl border py-6 shadow-sm",e),...a})}function r(n){let{className:e,...a}=n;return(0,t.jsx)("div",{"data-slot":"card-header",className:(0,s.cn)("@container/card-header grid auto-rows-min grid-rows-[auto_auto] items-start gap-1.5 px-6 has-data-[slot=card-action]:grid-cols-[1fr_auto] [.border-b]:pb-6",e),...a})}function o(n){let{className:e,...a}=n;return(0,t.jsx)("div",{"data-slot":"card-title",className:(0,s.cn)("leading-none font-semibold",e),...a})}function c(n){let{className:e,...a}=n;return(0,t.jsx)("div",{"data-slot":"card-description",className:(0,s.cn)("text-muted-foreground text-sm",e),...a})}function d(n){let{className:e,...a}=n;return(0,t.jsx)("div",{"data-slot":"card-content",className:(0,s.cn)("px-6",e),...a})}},97168:(n,e,a)=>{a.d(e,{$:()=>c,r:()=>o});var t=a(95155);a(12115);var s=a(99708),i=a(74466),r=a(53999);let o=(0,i.F)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg:not([class*='size-'])]:size-4 shrink-0 [&_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",{variants:{variant:{default:"bg-primary text-primary-foreground shadow-xs hover:bg-primary/90",destructive:"bg-destructive text-white shadow-xs hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60",outline:"border bg-background shadow-xs hover:bg-accent hover:text-accent-foreground dark:bg-input/30 dark:border-input dark:hover:bg-input/50",secondary:"bg-secondary text-secondary-foreground shadow-xs hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-9 px-4 py-2 has-[>svg]:px-3",sm:"h-8 rounded-md gap-1.5 px-3 has-[>svg]:px-2.5",lg:"h-10 rounded-md px-6 has-[>svg]:px-4",icon:"size-9"}},defaultVariants:{variant:"default",size:"default"}});function c(n){let{className:e,variant:a,size:i,asChild:c=!1,...d}=n,l=c?s.DX:"button";return(0,t.jsx)(l,{"data-slot":"button",className:(0,r.cn)(o({variant:a,size:i,className:e})),...d})}}}]);